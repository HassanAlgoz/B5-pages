<!DOCTYPE html>
<html lang="en"><head>
<link href="../../assets/icon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="malfadly@sdaia.gov.sa">
  <title>AI Pros Bootcamp – Connecting to Backend Databases</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-2476b6dbe24137c74cb80772f2f63bf0.css">
  <link rel="stylesheet" href="../../assets/sdaia.scss">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" href="../../assets/icon.svg">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../../assets/anim.svg" data-background-opacity="0.1" class="quarto-title-block center">
  <h1 class="title">Connecting to Backend Databases</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="the-hook" class="slide level2">
<h2>The Hook</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/connecting_python_to_database.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure: A stylized pipeline connecting a database cylinder to a Python logo, symbolizing a robust connection."><img data-src="./assets/connecting_python_to_database.png" alt="Figure: A stylized pipeline connecting a database cylinder to a Python logo, symbolizing a robust connection."></a></p>
<figcaption>Figure: A stylized pipeline connecting a database cylinder to a Python logo, symbolizing a robust connection.</figcaption>
</figure>
</div>
<p><strong>How do I direct my SQL commands to a database system and connect my Python application to it?</strong></p>
<aside class="notes">
<p>We’ve built agents and APIs, but now we need persistent storage. Databases are the foundation of any real application. But how do we get started? We need to understand the environment where databases run, how to set them up reliably, and how to connect our Python code to them. This journey will take us through virtualization, Docker containers, connection protocols, and modern Python frameworks that make database work practical and safe.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="todays-journey-12" class="slide level2">
<h2>Today’s Journey (1/2)</h2>
<ol type="1">
<li><strong>Setting Up the Database</strong>
<ul>
<li>Environment setup and virtualization</li>
<li>Docker containers vs virtual machines</li>
<li>Running PostgreSQL with Docker Compose</li>
</ul></li>
<li><strong>Connecting the Application</strong>
<ul>
<li>Using psycopg driver</li>
<li>DB-API 2.0 protocol</li>
<li>Transactions and cursors</li>
</ul></li>
</ol>
<aside class="notes">
<p>Today we’ll cover four major topics. First, we’ll set up a database environment using Docker, understanding the difference between containers and virtual machines. Then we’ll connect our Python application using the psycopg driver.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="todays-journey-22" class="slide level2">
<h2>Today’s Journey (2/2)</h2>
<ol start="3" type="1">
<li><strong>SQLAlchemy Framework</strong>
<ul>
<li>Core concepts: Engine, Metadata, Tables</li>
<li>Building queries in Python</li>
<li>Connection pooling</li>
</ul></li>
<li><strong>Database Migrations</strong>
<ul>
<li>Version control for schema</li>
<li>Migration scripts with dbmate</li>
<li>Safe schema evolution</li>
</ul></li>
</ol>
<aside class="notes">
<p>Next, we’ll level up to SQLAlchemy, a framework that solves many problems with raw database drivers. Finally, we’ll learn about migrations—the professional way to evolve your database schema without losing data. Each step builds on the previous one.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="part-1-setting-up-the-database" class="slide level2">
<h2>Part 1: Setting Up the Database</h2>
</section>
<section id="the-problem-environment-complexity" class="slide level2">
<h2>The Problem: Environment Complexity</h2>
<p><strong>Software needs an environment</strong></p>
<ul>
<li>CPU architecture (x86/x64, ARM)</li>
<li>Operating system</li>
<li>Memory and I/O devices</li>
<li>Installed binaries and libraries</li>
<li>Configuration files</li>
</ul>
<p><strong>The challenge:</strong> Conflicts between different software requirements</p>
<aside class="notes">
<p>A database is software—compiled binary instructions that run on hardware. But software doesn’t run in isolation. It needs an environment: the right CPU architecture, operating system, memory, network access, storage, installed libraries, and configuration files. The problem developers have faced for decades is that different software needs different environments, and these can conflict with each other. One project needs Python 3.9, another needs 3.11. One needs PostgreSQL 14, another needs 16. Managing these conflicts manually is a nightmare.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-solution-containerization" class="slide level2">
<h2>The Solution: Containerization</h2>
<div class="columns">
<div class="column" style="width:75%;">
<p><strong>Docker packages everything together</strong></p>
<ul>
<li>Application binaries</li>
<li>Libraries and dependencies</li>
<li>Configuration files</li>
<li>All in one isolated container</li>
</ul>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/transparent_container.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure: A transparent shipping container revealing neatly packed binaries, libraries, and configurations. (Click to Enlarge)"><img data-src="./assets/transparent_container.png" alt="Figure: A transparent shipping container revealing neatly packed binaries, libraries, and configurations. (Click to Enlarge)"></a></p>
<figcaption>Figure: A transparent shipping container revealing neatly packed binaries, libraries, and configurations. <strong>(Click to Enlarge)</strong></figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>Docker emerged as a solution. Instead of just packaging compiled binaries, Docker packages everything: the binaries, the libraries, the configuration files—all into a single unit called a container. The Docker platform on your machine runs these containers in isolation from each other, preventing conflicts. This is a fundamental shift in how we think about deployable units.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="benefits-of-containerization" class="slide level2">
<h2>Benefits of Containerization</h2>
<ul>
<li><strong>Better development experience</strong>
<ul>
<li>Focus on real problems, not environment setup</li>
</ul></li>
<li><strong>Easier collaboration</strong>
<ul>
<li>Every developer has the same environment</li>
</ul></li>
<li><strong>Project isolation</strong>
<ul>
<li>Switch between projects without conflicts</li>
</ul></li>
<li><strong>Simplified deployment</strong>
<ul>
<li>Same container works in development and production</li>
</ul></li>
</ul>
<aside class="notes">
<p>The benefits are immediate. You can focus on solving actual application problems instead of wrestling with environment setup. When collaborating, everyone runs the exact same environment. You can work on multiple projects on the same machine without conflicts. And the same container that works on your laptop works in production. This abstraction removes a huge class of problems.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="virtualization-background" class="slide level2">
<h2>Virtualization Background</h2>
<div class="columns">
<div class="column" style="width:75%;">
<ul>
<li><strong>Virtualization (1966)</strong>
<ul>
<li>Dividing expensive mainframes into multiple virtual computers</li>
<li>Foundation of cloud computing</li>
</ul></li>
<li><strong>Containerization (2008-2013)</strong>
<ul>
<li>Internal project at dotCloud (France)</li>
<li>Open-sourced as Docker by Solomon Hykes (March 2013)</li>
</ul></li>
</ul>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/timeline_from_mainframe_to_virtualization_to_containerization.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure: A timeline showing the evolution from mainframes to virtual machines and finally to containers."><img data-src="./assets/timeline_from_mainframe_to_virtualization_to_containerization.png" alt="Figure: A timeline showing the evolution from mainframes to virtual machines and finally to containers."></a></p>
<figcaption>Figure: A timeline showing the evolution from mainframes to virtual machines and finally to containers.</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>This didn’t come out of nowhere. Virtualization dates back to 1966, when expensive mainframes were divided into multiple virtual computers for better efficiency. That’s the foundation of cloud computing. Containerization evolved from this. It started as an internal project at dotCloud in France around 2008, and was open-sourced as Docker in March 2013 by Solomon Hykes. It’s a relatively recent innovation that’s become essential.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="container-vs-virtual-machine" class="slide level2">
<h2>Container vs Virtual Machine</h2>
<p><strong>Both are isolated environments from an image</strong></p>
<p><strong>Difference:</strong> What the image contains</p>
<ul>
<li><strong>VM Image:</strong> Full operating system</li>
<li><strong>Container Image:</strong> Shared host OS kernel</li>
</ul>
<p><strong>Containers are lighter:</strong></p>
<ul>
<li>Less resource consumption</li>
<li>Faster startup/shutdown</li>
<li>Easier to manage</li>
</ul>
<aside class="notes">
<p>Both containers and virtual machines provide isolated environments created from images. The key difference is what’s in the image. A VM image includes a full operating system. A container image shares the host OS kernel. This makes containers much lighter—they consume fewer resources, start and stop faster, and are easier to manage. For most applications, containers are the better choice.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="running-postgresql-with-docker" class="slide level2">
<h2>Running PostgreSQL with Docker</h2>
<p><strong>Step 1: Create environment file (<code>.env</code>)</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource env number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a></a>POSTGRES_HOST=127.0.0.1</span>
<span id="cb1-2"><a></a>POSTGRES_DB=mydatabase</span>
<span id="cb1-3"><a></a>POSTGRES_USER=user</span>
<span id="cb1-4"><a></a>POSTGRES_PASSWORD=secret</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Now let’s get practical. First, we create an environment file to store our database configuration. This keeps sensitive information like passwords out of our code. We’ll reference this file in our Docker Compose configuration.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="docker-compose-configuration" class="slide level2">
<h2>Docker Compose Configuration</h2>
<p><strong>Step 2: Define services in <code>compose.yaml</code></strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb2-2"><a></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb2-3"><a></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:17.6</span></span>
<span id="cb2-4"><a></a><span class="at">    </span><span class="fu">env_file</span><span class="kw">:</span></span>
<span id="cb2-5"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> .env</span></span>
<span id="cb2-6"><a></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb2-7"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"5432:5432"</span></span>
<span id="cb2-8"><a></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb2-9"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> pgdata:/var/lib/postgresql/data</span></span>
<span id="cb2-10"><a></a></span>
<span id="cb2-11"><a></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb2-12"><a></a><span class="at">  </span><span class="fu">pgdata</span><span class="kw">:</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Docker Compose lets us define our services in a YAML file. We specify the PostgreSQL image from DockerHub, point to our environment file, map the port so we can connect from outside the container, and most importantly, create a volume to persist data. Without the volume, all data would be lost when the container stops.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="understanding-docker-compose-elements" class="slide level2">
<h2>Understanding Docker Compose Elements</h2>
<ul>
<li><strong><code>image: postgres:17.6</code></strong> - Image name and version from DockerHub</li>
<li><strong><code>env_file</code></strong> - References our <code>.env</code> file</li>
<li><strong><code>ports: "5432:5432"</code></strong> - Maps host port to container port</li>
<li><strong><code>volumes: pgdata</code></strong> - Persists data outside the container</li>
</ul>
<aside class="notes">
<p>Let’s break down what each part does. The image tells Docker what to download from DockerHub. The env_file loads our configuration. The ports mapping lets us connect from our host machine. And the volume is critical—it stores the database data on the host filesystem, so it persists even when the container is destroyed. This is how we solve the data persistence problem.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="starting-and-stopping" class="slide level2">
<h2>Starting and Stopping</h2>
<p><strong>Start the database:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">docker</span> compose up</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Stop the database:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="ex">docker</span> compose down</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Starting is simple: just run <code>docker compose up</code>. Docker will download the image if needed, create the container, and start it. To stop, use <code>docker compose down</code>. The data in the volume persists, so when you start again, your data is still there.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="connecting-to-the-database" class="slide level2">
<h2>Connecting to the Database</h2>
<p><strong>Two approaches:</strong></p>
<ol type="1">
<li><strong>Command line:</strong> <code>psql</code> (text interface)</li>
<li><strong>Graphical:</strong> Adminer or VS Code Database Client</li>
</ol>
<aside class="notes">
<p>Once the database is running, we need to connect to it. There are two main approaches: the command-line tool psql, which is powerful but text-based, or graphical tools like Adminer or the VS Code Database Client extension, which are more user-friendly. Both work, choose based on your preference.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="part-2-connecting-the-application" class="slide level2">
<h2>Part 2: Connecting the Application</h2>
</section>
<section id="the-question" class="slide level2">
<h2>The Question</h2>
<p><strong>How do I connect a Python application to the database to query and store data?</strong></p>
<p><strong>Answer:</strong> Use the <code>psycopg</code> package</p>
<aside class="notes">
<p>Now that we have a running database, we need to connect our Python code to it. The answer is the psycopg package, which implements the DB-API 2.0 protocol. This is the standard way Python talks to PostgreSQL databases.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="db-api-2.0-protocol" class="slide level2">
<h2>DB-API 2.0 Protocol</h2>
<p><strong>Standardized database interface in Python</strong></p>
<ul>
<li><code>psycopg</code> implements this protocol</li>
<li>Works with PostgreSQL</li>
<li>Knowledge transfers to other databases</li>
</ul>
<aside class="notes">
<p>The DB-API 2.0 is a standardized protocol for database access in Python. psycopg implements this protocol for PostgreSQL. The beautiful thing is that once you understand this protocol, you can apply the same concepts to other database drivers. The patterns are consistent.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="step-1-import-and-install" class="slide level2">
<h2>Step 1: Import and Install</h2>
<p><strong>Install the package:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">uv</span> add <span class="st">"psycopg[binary]"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Import in Python:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">import</span> psycopg</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>First, we install psycopg using uv. The [binary] extra includes pre-compiled binaries for faster installation. Then we import it in our Python code. Simple enough.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="step-2-create-connection" class="slide level2">
<h2>Step 2: Create Connection</h2>
<p><strong>Connection string format:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>conn <span class="op">=</span> psycopg.<span class="ex">connect</span>(</span>
<span id="cb7-2"><a></a>    <span class="st">'postgresql://user:password@localhost:5432/dbname'</span></span>
<span id="cb7-3"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Or with parameters:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a>conn <span class="op">=</span> psycopg.<span class="ex">connect</span>(</span>
<span id="cb8-2"><a></a>    conninfo<span class="op">=</span><span class="st">'user=user password=secret '</span></span>
<span id="cb8-3"><a></a>             <span class="st">'host=localhost port=5432 dbname=testdb'</span></span>
<span id="cb8-4"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Creating a connection requires connection information: the user, password, host, port, and database name. You can provide this as a URI string or as individual parameters. The URI format is more compact and commonly used. Notice we’re using localhost and port 5432, which matches our Docker setup.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="connection-string-sources" class="slide level2">
<h2>Connection String Sources</h2>
<p><strong>Two places connection info can come from:</strong></p>
<ol type="1">
<li><strong>Environment variables</strong> (from <code>.env</code> file)</li>
<li><strong>Connection string parameter</strong> (<code>conninfo</code>)</li>
</ol>
<p><strong>Both are checked by psycopg</strong></p>
<aside class="notes">
<p>It’s important to know that psycopg checks two places for connection information: environment variables and the connection string parameter. Some values might be set in your <code>.env</code> file, others in the connection string. If you’re having connection issues, check both places.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="step-3-working-with-data" class="slide level2">
<h2>Step 3: Working with Data</h2>
</section>
<section id="reading-data" class="slide level2">
<h2>Reading Data</h2>
<p><strong>Four ways to fetch results:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>cur.execute(<span class="st">"SELECT * FROM test"</span>)</span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a><span class="co"># Fetch one row</span></span>
<span id="cb9-4"><a></a>row <span class="op">=</span> cur.fetchone()</span>
<span id="cb9-5"><a></a></span>
<span id="cb9-6"><a></a><span class="co"># Fetch many rows</span></span>
<span id="cb9-7"><a></a>rows <span class="op">=</span> cur.fetchmany(<span class="dv">10</span>)</span>
<span id="cb9-8"><a></a></span>
<span id="cb9-9"><a></a><span class="co"># Fetch all rows</span></span>
<span id="cb9-10"><a></a>all_rows <span class="op">=</span> cur.fetchall()</span>
<span id="cb9-11"><a></a></span>
<span id="cb9-12"><a></a><span class="co"># Or iterate</span></span>
<span id="cb9-13"><a></a><span class="cf">for</span> row <span class="kw">in</span> cur:</span>
<span id="cb9-14"><a></a>    <span class="bu">print</span>(row)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>For reading data, we have three main methods: fetchone gets a single row, fetchmany gets a specified number, and fetchall gets everything. The cursor is also iterable, so you can loop over it directly. For large result sets, be careful with fetchall—it loads everything into memory at once.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p><strong>Create a cursor from the connection:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="cf">with</span> conn.cursor() <span class="im">as</span> cur:</span>
<span id="cb10-2"><a></a>    cur.execute(<span class="st">"SELECT * FROM users"</span>)</span>
<span id="cb10-3"><a></a>    results <span class="op">=</span> cur.fetchall()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>To interact with the database, we create a cursor from the connection. The cursor is our interface for sending commands and reading results. We use a context manager (the <code>with</code> statement) to ensure proper cleanup. Then we execute SQL commands and fetch results.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="writing-data" class="slide level2">
<h2>Writing Data</h2>
<p><strong>Using transactions:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="cf">with</span> psycopg.<span class="ex">connect</span>(conn_string) <span class="im">as</span> conn:</span>
<span id="cb11-2"><a></a>    <span class="cf">with</span> conn.cursor() <span class="im">as</span> cur:</span>
<span id="cb11-3"><a></a>        cur.execute(</span>
<span id="cb11-4"><a></a>            <span class="st">"INSERT INTO test (num, data) VALUES (</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%s</span><span class="st">)"</span>,</span>
<span id="cb11-5"><a></a>            (<span class="dv">100</span>, <span class="st">"abc'def"</span>)</span>
<span id="cb11-6"><a></a>        )</span>
<span id="cb11-7"><a></a>        <span class="co"># Transaction commits automatically</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>When writing data, we use transactions. The connection context manager automatically handles this. If everything succeeds, it commits. If an error occurs, it rolls back. This ensures data integrity. Notice we use parameterized queries with <code>%s</code> placeholders—this prevents SQL injection attacks.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="problems-with-raw-drivers" class="slide level2">
<h2>Problems with Raw Drivers</h2>
<p><strong>What psycopg doesn’t solve:</strong></p>
<ol type="1">
<li>SQL written as strings → typos, syntax errors</li>
<li>Parameter passing → SQL injection risks</li>
<li>Database-specific code → hard to switch databases</li>
<li>Connection management → expensive to create connections</li>
</ol>
<aside class="notes">
<p>While psycopg works, it has limitations. Writing SQL as strings means typos and syntax errors aren’t caught until runtime. Parameter passing can be error-prone. The code is database-specific, making it hard to switch databases. And creating connections is expensive—we need connection pooling. This is where SQLAlchemy comes in.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="part-3-sqlalchemy-framework" class="slide level2">
<h2>Part 3: SQLAlchemy Framework</h2>
</section>
<section id="what-is-sqlalchemy" class="slide level2">
<h2>What is SQLAlchemy?</h2>
<div class="columns">
<div class="column" style="width:75%;">
<p><strong>Python’s most popular database framework</strong></p>
<ul>
<li>Raises database work to a higher level</li>
<li>Solves driver limitations</li>
<li>Two parts: Core and ORM</li>
</ul>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/sqlalchemy_flow.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure: A diagram showing raw SQL transforming through SQLAlchemy into clean Python code."><img data-src="./assets/sqlalchemy_flow.png" alt="Figure: A diagram showing raw SQL transforming through SQLAlchemy into clean Python code."></a></p>
<figcaption>Figure: A diagram showing raw SQL transforming through SQLAlchemy into clean Python code.</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>SQLAlchemy is Python’s most popular database framework. It elevates database work from the low-level driver world to a higher abstraction. It solves all those problems we just identified: type safety, security, database portability, and connection pooling. SQLAlchemy has two main parts: Core, which we’ll focus on, and ORM, which maps database tables to Python classes.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-engine" class="slide level2">
<h2>The Engine</h2>
<p><strong>Central component: manages connections</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine, URL</span>
<span id="cb12-2"><a></a></span>
<span id="cb12-3"><a></a>engine <span class="op">=</span> create_engine(</span>
<span id="cb12-4"><a></a>    url<span class="op">=</span>URL.create(</span>
<span id="cb12-5"><a></a>        <span class="st">"postgresql+psycopg"</span>,</span>
<span id="cb12-6"><a></a>        username<span class="op">=</span>os.getenv(<span class="st">"POSTGRES_USER"</span>),</span>
<span id="cb12-7"><a></a>        password<span class="op">=</span>os.getenv(<span class="st">"POSTGRES_PASSWORD"</span>),</span>
<span id="cb12-8"><a></a>        host<span class="op">=</span>os.getenv(<span class="st">"POSTGRES_HOST"</span>),</span>
<span id="cb12-9"><a></a>        database<span class="op">=</span>os.getenv(<span class="st">"POSTGRES_DB"</span>),</span>
<span id="cb12-10"><a></a>    )</span>
<span id="cb12-11"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Usually a singleton (one per database)</strong></p>
<aside class="notes">
<p>The Engine is the heart of SQLAlchemy. It manages connection pooling—creating connections, keeping them alive, and reusing them. This solves the expensive connection creation problem. You typically create one engine per database, and it’s shared across your application. Notice the connection string format: “postgresql+psycopg” where postgresql is the dialect and psycopg is the driver.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="dialect-vs-driver" class="slide level2">
<h2>Dialect vs Driver</h2>
<p><strong>Connection string: <code>postgresql+psycopg</code></strong></p>
<ul>
<li><strong>Dialect</strong> (<code>postgresql</code>): SQL language variant
<ul>
<li>Also: <code>mysql</code>, <code>sqlite</code>, <code>mssql</code>, <code>oracle</code></li>
</ul></li>
<li><strong>Driver</strong> (<code>psycopg</code>): Low-level communication
<ul>
<li>Also: <code>asyncpg</code>, <code>pymysql</code>, <code>pyodbc</code></li>
</ul></li>
</ul>
<p><strong>Separation allows flexibility</strong></p>
<aside class="notes">
<p>The connection string separates dialect from driver. The dialect is the SQL language variant—PostgreSQL has different syntax than MySQL. The driver is the low-level communication library. This separation is powerful: you can use different drivers with the same dialect, or switch dialects while keeping similar code structure.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="defining-schema-with-metadata" class="slide level2">
<h2>Defining Schema with Metadata</h2>
<p><strong>Metadata: describes your database structure</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a><span class="im">from</span> sqlalchemy.schema <span class="im">import</span> MetaData, Table, Column</span>
<span id="cb13-2"><a></a><span class="im">from</span> sqlalchemy.types <span class="im">import</span> Integer, String, Date</span>
<span id="cb13-3"><a></a></span>
<span id="cb13-4"><a></a>metadata <span class="op">=</span> MetaData()</span>
<span id="cb13-5"><a></a></span>
<span id="cb13-6"><a></a>users_table <span class="op">=</span> Table(</span>
<span id="cb13-7"><a></a>    <span class="st">"users"</span>,</span>
<span id="cb13-8"><a></a>    metadata,</span>
<span id="cb13-9"><a></a>    Column(<span class="st">"id"</span>, Integer, primary_key<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb13-10"><a></a>    Column(<span class="st">"name"</span>, String(<span class="dv">100</span>)),</span>
<span id="cb13-11"><a></a>    Column(<span class="st">"birth_date"</span>, Date)</span>
<span id="cb13-12"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Instead of writing raw SQL CREATE TABLE statements, we define our schema using Python objects. Metadata is a container for all our table definitions. We create Table objects with Column definitions. This gives us type safety and Python’s help with autocomplete and error checking.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="creating-tables" class="slide level2">
<h2>Creating Tables</h2>
<p><strong>Apply definitions to database:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>metadata.create_all(engine)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Translates to SQL:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb15-2"><a></a>    <span class="kw">id</span> <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb15-3"><a></a>    name <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb15-4"><a></a>    birth_date <span class="dt">DATE</span>,</span>
<span id="cb15-5"><a></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>)</span>
<span id="cb15-6"><a></a>);</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>When we call <code>create_all</code>, SQLAlchemy translates our Python definitions into SQL DDL statements and executes them. This is much safer than writing SQL by hand—we get Python’s type checking and IDE support. However, this method is destructive and only suitable for development. For production, we need migrations.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="foreign-keys" class="slide level2">
<h2>Foreign Keys</h2>
<p><strong>Defining relationships:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="im">from</span> sqlalchemy.schema <span class="im">import</span> ForeignKey</span>
<span id="cb16-2"><a></a></span>
<span id="cb16-3"><a></a>user_emails_table <span class="op">=</span> Table(</span>
<span id="cb16-4"><a></a>    <span class="st">"user_emails"</span>,</span>
<span id="cb16-5"><a></a>    metadata,</span>
<span id="cb16-6"><a></a>    Column(<span class="st">"id"</span>, Integer, primary_key<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb16-7"><a></a>    Column(<span class="st">"user_id"</span>, ForeignKey(<span class="st">"users.id"</span>), nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb16-8"><a></a>    Column(<span class="st">"email"</span>, String, nullable<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb16-9"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Foreign keys define relationships between tables. Here, each email must belong to a user. The ForeignKey constraint ensures data integrity—you can’t create an email without a valid user_id. SQLAlchemy handles the SQL translation automatically.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="inserting-data" class="slide level2">
<h2>Inserting Data</h2>
<p><strong>Building insert statements:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="im">from</span> sqlalchemy.sql.expression <span class="im">import</span> insert</span>
<span id="cb17-2"><a></a></span>
<span id="cb17-3"><a></a>stmt <span class="op">=</span> (</span>
<span id="cb17-4"><a></a>    insert(users_table)</span>
<span id="cb17-5"><a></a>    .values(</span>
<span id="cb17-6"><a></a>        name<span class="op">=</span><span class="st">"Adam Banana"</span>,</span>
<span id="cb17-7"><a></a>        birth_date<span class="op">=</span>datetime.date(<span class="dv">1990</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb17-8"><a></a>    )</span>
<span id="cb17-9"><a></a>    .returning(users_table.c.<span class="bu">id</span>)</span>
<span id="cb17-10"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Instead of writing INSERT SQL strings, we build statements using Python functions. The <code>.values()</code> method sets the data to insert. The <code>.returning()</code> clause gets back the generated ID. This is type-safe and prevents SQL injection.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="executing-statements" class="slide level2">
<h2>Executing Statements</h2>
<p><strong>Sending to database:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="cf">with</span> engine.<span class="ex">connect</span>() <span class="im">as</span> conn:</span>
<span id="cb18-2"><a></a>    result <span class="op">=</span> conn.execute(stmt)</span>
<span id="cb18-3"><a></a>    conn.commit()</span>
<span id="cb18-4"><a></a>    row <span class="op">=</span> result.fetchone()</span>
<span id="cb18-5"><a></a>    user_id <span class="op">=</span> row[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>We get a connection from the engine, execute our statement, commit the transaction, and fetch the result. The connection context manager handles cleanup. The result cursor works just like psycopg cursors, following the DB-API standard.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="selecting-data" class="slide level2">
<h2>Selecting Data</h2>
<p><strong>Building SELECT queries:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="im">from</span> sqlalchemy.sql.expression <span class="im">import</span> select</span>
<span id="cb19-2"><a></a></span>
<span id="cb19-3"><a></a>stmt <span class="op">=</span> (</span>
<span id="cb19-4"><a></a>    select(users_table.c.name, users_table.c.birth_date)</span>
<span id="cb19-5"><a></a>    .where(users_table.c.<span class="bu">id</span> <span class="op">==</span> user_id)</span>
<span id="cb19-6"><a></a>)</span>
<span id="cb19-7"><a></a></span>
<span id="cb19-8"><a></a><span class="cf">with</span> engine.<span class="ex">connect</span>() <span class="im">as</span> conn:</span>
<span id="cb19-9"><a></a>    result <span class="op">=</span> conn.execute(stmt)</span>
<span id="cb19-10"><a></a>    row <span class="op">=</span> result.fetchone()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>SELECT queries are built using the <code>select()</code> function. We reference columns using <code>table.c.column_name</code> syntax, which gives us autocomplete and type checking. The <code>.where()</code> method adds conditions. This is much safer than string concatenation.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="aggregations" class="slide level2">
<h2>Aggregations</h2>
<p><strong>Using SQL functions:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="im">from</span> sqlalchemy.sql.functions <span class="im">import</span> count</span>
<span id="cb20-2"><a></a></span>
<span id="cb20-3"><a></a>stmt <span class="op">=</span> (</span>
<span id="cb20-4"><a></a>    select(</span>
<span id="cb20-5"><a></a>        user_emails_table.c.user_id,</span>
<span id="cb20-6"><a></a>        count(user_emails_table.c.email)</span>
<span id="cb20-7"><a></a>    )</span>
<span id="cb20-8"><a></a>    .group_by(user_emails_table.c.user_id)</span>
<span id="cb20-9"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>SQLAlchemy provides functions for aggregations like count, sum, min, max. We use them in select statements and combine with group_by for summaries. All of this is type-safe and translates to correct SQL.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="raw-sql-when-needed" class="slide level2">
<h2>Raw SQL When Needed</h2>
<p><strong>SQLAlchemy allows raw SQL:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a><span class="im">from</span> sqlalchemy <span class="im">import</span> text</span>
<span id="cb21-2"><a></a></span>
<span id="cb21-3"><a></a>sql_text <span class="op">=</span> text(</span>
<span id="cb21-4"><a></a>    <span class="st">"SELECT name, salary FROM employees "</span></span>
<span id="cb21-5"><a></a>    <span class="st">"WHERE department = :dept AND salary &gt; :min_sal"</span></span>
<span id="cb21-6"><a></a>)</span>
<span id="cb21-7"><a></a></span>
<span id="cb21-8"><a></a>result <span class="op">=</span> conn.execute(</span>
<span id="cb21-9"><a></a>    sql_text,</span>
<span id="cb21-10"><a></a>    {<span class="st">"dept"</span>: <span class="st">"Sales"</span>, <span class="st">"min_sal"</span>: <span class="dv">50000</span>}</span>
<span id="cb21-11"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Sometimes you need raw SQL for complex queries. SQLAlchemy allows this through the <code>text()</code> function. Notice we still use parameterized queries with <code>:parameter_name</code> syntax. This maintains security by preventing SQL injection while giving us the flexibility of raw SQL when needed.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="part-4-database-migrations" class="slide level2">
<h2>Part 4: Database Migrations</h2>
</section>
<section id="the-problem" class="slide level2">
<h2>The Problem</h2>
<p><strong>Schema changes are dangerous:</strong></p>
<ul>
<li>Changes applied manually → not reproducible</li>
<li>Hard to roll back → data loss risk</li>
<li>Different environments get out of sync</li>
<li>No history of what changed</li>
</ul>
<aside class="notes">
<p>We’ve been using <code>create_all()</code> and <code>drop_all()</code>, but these are destructive and only work for development. In real applications, we need to evolve the schema over time without losing data. Manual changes are dangerous—they’re not reproducible, hard to roll back, and environments drift apart. We need version control for our database schema, just like we have for our code.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="version-control-for-code" class="slide level2">
<h2>Version Control for Code</h2>
<div class="columns">
<div class="column" style="width:75%;">
<p><strong>Git tracks code changes:</strong></p>
<ul>
<li>Line-by-line history</li>
<li>Time travel (undo)</li>
<li>Review before merging</li>
<li>Collaboration</li>
</ul>
<p><strong>We need the same for database schema</strong></p>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/diffs.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure: A split-view document showing code diffs with red deletions and green additions under a branching icon."><img data-src="./assets/diffs.png" alt="Figure: A split-view document showing code diffs with red deletions and green additions under a branching icon."></a></p>
<figcaption>Figure: A split-view document showing code diffs with red deletions and green additions under a branching icon.</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>We use git for version control of our code. It tracks every change, lets us travel back in time, requires review before merging, and enables collaboration. We need the exact same thing for our database schema. Every schema change should be a script that’s tracked in git, reviewed, and applied consistently across all environments.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="migration-scripts" class="slide level2">
<h2>Migration Scripts</h2>
<p><strong>Solution: Migration scripts</strong></p>
<ul>
<li>Each change is a script</li>
<li>Tracked in git</li>
<li>Reversible (up and down)</li>
<li>Applied automatically</li>
</ul>
<p><strong>Tool: <code>dbmate</code></strong></p>
<aside class="notes">
<p>The solution is migration scripts. Each schema change becomes a script that’s tracked in git. Each script has an “up” direction (apply the change) and a “down” direction (reverse it). These scripts are applied automatically, ensuring all environments stay in sync. We’ll use dbmate, a simple and effective migration tool.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="installing-dbmate" class="slide level2">
<h2>Installing dbmate</h2>
<p><strong>On Linux:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a></a><span class="fu">sudo</span> curl <span class="at">-fsSL</span> <span class="at">-o</span> /usr/local/bin/dbmate <span class="dt">\</span></span>
<span id="cb22-2"><a></a>  https://github.com/amacneil/dbmate/releases/latest/download/dbmate-linux-amd64</span>
<span id="cb22-3"><a></a><span class="fu">sudo</span> chmod +x /usr/local/bin/dbmate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>dbmate is a single binary, making installation straightforward. We download it, make it executable, and it’s ready to use. It reads the DATABASE_URL from environment variables or a .env file.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="configuration" class="slide level2">
<h2>Configuration</h2>
<p><strong>Set DATABASE_URL in <code>.env</code>:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource env number-lines code-with-copy"><code class="sourceCode"><span id="cb23-1"><a></a>DATABASE_URL="postgres://user:password@127.0.0.1:5432/testdb?sslmode=disable"</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>dbmate reads this automatically</strong></p>
<aside class="notes">
<p>dbmate looks for a DATABASE_URL environment variable. We can set it in our .env file. The format is a standard database URI. Notice the <code>?sslmode=disable</code> parameter—we’re disabling SSL since we’re running locally. dbmate will read this automatically.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="creating-a-migration" class="slide level2">
<h2>Creating a Migration</h2>
<p><strong>Generate new migration file:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a></a><span class="ex">dbmate</span> new <span class="st">"add_users_table"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Creates a file with two sections:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a></a><span class="co">-- migrate:up</span></span>
<span id="cb25-2"><a></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (<span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>);</span>
<span id="cb25-3"><a></a></span>
<span id="cb25-4"><a></a><span class="co">-- migrate:down</span></span>
<span id="cb25-5"><a></a><span class="kw">DROP</span> <span class="kw">TABLE</span> users;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>To create a migration, we run <code>dbmate new</code> with a descriptive name. This creates a new migration file with two sections: <code>migrate:up</code> for applying the change, and <code>migrate:down</code> for reversing it. We write the SQL for both directions. This ensures we can always roll back.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="applying-migrations" class="slide level2">
<h2>Applying Migrations</h2>
<p><strong>Run pending migrations:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a></a><span class="ex">dbmate</span> up</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Roll back last migration:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a></a><span class="ex">dbmate</span> down</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Check status:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a></a><span class="ex">dbmate</span> status</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>To apply migrations, we run <code>dbmate up</code>. It checks which migrations have been applied and runs only the new ones. To roll back, we use <code>dbmate down</code>, which reverses the most recent migration. We can check the status to see which migrations have been applied.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="migration-workflow-12" class="slide level2">
<h2>Migration Workflow (1/2)</h2>
<p><strong>1. Create migration:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a></a><span class="ex">dbmate</span> new <span class="st">"add_email_column"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>2. Write up and down SQL:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a></a><span class="co">-- migrate:up</span></span>
<span id="cb30-2"><a></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> users <span class="kw">ADD</span> <span class="kw">COLUMN</span> email <span class="dt">VARCHAR</span>;</span>
<span id="cb30-3"><a></a></span>
<span id="cb30-4"><a></a><span class="co">-- migrate:down</span></span>
<span id="cb30-5"><a></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> users <span class="kw">DROP</span> <span class="kw">COLUMN</span> email;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="migration-workflow-22" class="slide level2">
<h2>Migration Workflow (2/2)</h2>
<p><strong>3. Update Python models:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a>users <span class="op">=</span> Table(</span>
<span id="cb31-2"><a></a>    <span class="st">"users"</span>,</span>
<span id="cb31-3"><a></a>    metadata,</span>
<span id="cb31-4"><a></a>    Column(<span class="st">"id"</span>, Integer, primary_key<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb31-5"><a></a>    Column(<span class="st">"email"</span>, String),  <span class="co"># NEW</span></span>
<span id="cb31-6"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>4. Commit both together:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a></a><span class="fu">git</span> add db/migrations/xxx_add_email_column.sql</span>
<span id="cb32-2"><a></a><span class="fu">git</span> add src/models.py</span>
<span id="cb32-3"><a></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"schema: add email column to users"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>Here’s the professional workflow. We create a migration, write both the up and down SQL, update our Python models to match, and commit both the migration script and the model changes together in a single git commit. This keeps everything in sync. If someone pulls this commit, they get both the migration and the code that uses it.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="key-takeaways" class="slide level2">
<h2>Key Takeaways</h2>
</section>
<section id="database-setup" class="slide level2">
<h2>Database Setup</h2>
<ul>
<li><strong>Containers solve environment problems</strong>
<ul>
<li>Package everything together</li>
<li>Isolated from conflicts</li>
<li>Same environment everywhere</li>
</ul></li>
<li><strong>Docker Compose simplifies orchestration</strong>
<ul>
<li>Define services in YAML</li>
<li>Volumes persist data</li>
<li>One command to start/stop</li>
</ul></li>
</ul>
<aside class="notes">
<p>Let’s recap what we’ve learned. Containers solve the environment problem by packaging everything together in isolation. Docker Compose makes it easy to define and run our database with a simple YAML file. Volumes ensure our data persists even when containers are destroyed.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="database-connections" class="slide level2">
<h2>Database Connections</h2>
<ul>
<li><strong>DB-API 2.0 is the standard</strong>
<ul>
<li>psycopg implements it for PostgreSQL</li>
<li>Patterns transfer to other databases</li>
</ul></li>
<li><strong>Transactions ensure data integrity</strong>
<ul>
<li>Automatic commit/rollback</li>
<li>Context managers handle cleanup</li>
</ul></li>
</ul>
<aside class="notes">
<p>DB-API 2.0 provides a standard interface for database access. psycopg implements this for PostgreSQL, and the patterns you learn apply to other database drivers. Transactions are crucial for data integrity, and context managers make them easy to use correctly.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="sqlalchemy-benefits" class="slide level2">
<h2>SQLAlchemy Benefits</h2>
<ul>
<li><strong>Type-safe database code</strong>
<ul>
<li>Python objects instead of SQL strings</li>
<li>IDE autocomplete and error checking</li>
</ul></li>
<li><strong>Connection pooling</strong>
<ul>
<li>Reuses expensive connections</li>
<li>Better performance</li>
</ul></li>
<li><strong>Database portability</strong>
<ul>
<li>Switch databases with minimal code changes</li>
<li>Dialect handles SQL differences</li>
</ul></li>
</ul>
<aside class="notes">
<p>SQLAlchemy elevates database work to a higher level. We get type safety through Python objects, connection pooling for better performance, and database portability through the dialect system. It solves all the problems we identified with raw drivers.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="migration-best-practices" class="slide level2">
<h2>Migration Best Practices</h2>
<ul>
<li><strong>Version control your schema</strong>
<ul>
<li>Every change is a script</li>
<li>Tracked in git</li>
<li>Reversible</li>
</ul></li>
<li><strong>Keep migrations and models in sync</strong>
<ul>
<li>Commit migration and code changes together</li>
<li>Ensures consistency across environments</li>
</ul></li>
</ul>
<aside class="notes">
<p>Migrations are essential for professional database development. Every schema change becomes a versioned script that’s tracked in git and reversible. Most importantly, we keep our migration scripts and Python models in sync by committing them together. This ensures everyone’s database schema matches their code.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-complete-picture" class="slide level2">
<h2>The Complete Picture</h2>
<div class="columns">
<div class="column" style="width:75%;">
<p><strong>You now have:</strong></p>
<ul>
<li>Isolated database environment (Docker)</li>
<li>Type-safe database code (SQLAlchemy)</li>
<li>Version-controlled schema (Migrations)</li>
<li>Professional workflow</li>
</ul>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="./assets/app_sqlalchemy_postgresql_migrations.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure: A system diagram connecting a Dockerized PostgreSQL database, Python app via SQLAlchemy, and Git-tracked migrations."><img data-src="./assets/app_sqlalchemy_postgresql_migrations.png" alt="Figure: A system diagram connecting a Dockerized PostgreSQL database, Python app via SQLAlchemy, and Git-tracked migrations."></a></p>
<figcaption>Figure: A system diagram connecting a Dockerized PostgreSQL database, Python app via SQLAlchemy, and Git-tracked migrations.</figcaption>
</figure>
</div>
</div></div>
<aside class="notes">
<p>Putting it all together: we have an isolated database running in Docker, type-safe database code using SQLAlchemy, version-controlled schema through migrations, and a professional workflow that scales from development to production. This is the foundation for building real applications with persistent data storage.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../assets/icon.svg" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"},{"title":"Index","icon":"<svg width='1.8rem' viewBox='0 0 24 24'><path d='M5 7h14M5 12h14M5 17h7' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>","src":"../index.html"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>