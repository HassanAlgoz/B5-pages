<!DOCTYPE html>
<html lang="en"><head>
<link href="../../../assets/icon.svg" rel="icon" type="image/svg+xml">
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="malfadly@sdaia.gov.sa">
  <title>AI Pros Bootcamp – متابعة تطورات المخطط</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto-2476b6dbe24137c74cb80772f2f63bf0.css">
  <link rel="stylesheet" href="../../../assets/sdaia.scss">
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" href="../../../assets/icon.svg">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../../../assets/anim.svg" data-background-opacity="0.1" class="quarto-title-block center">
  <h1 class="title">متابعة تطورات المخطط</h1>

<div class="quarto-title-authors">
</div>

</section>
<section class="slide level2">

<p>السؤال: ما هي الطريقة السليمة لتطوير مخطط قاعدة البيانات بحيث نتجنَّب خسارة البيانات أو تعارض المخطط التجريبي مع المخطط الحقيقي؟</p>
<p>للإجابة عن هذا يجب علينا معرفة خطورة التغييرات غير المكتوبة! خصوصًا حين يتشعب البرنامج وتكثر التفاصيل ونحتاج إلى ضبط عمليَّة التطوير لتتم بشكل احترافي خاضع لمعايير هندسية في الجودة.</p>
<p>الإشكال يكمُن في أن التغيير أمر لا مفر منه. فكلمة البرمجيَّة (Software) ترمُز كلمة (Soft) فيها لليونتها بعكس العتاد (Hardware) الذي هو معدَنٌ محفور. فإن من طبيعة البرمجيات النسخ المتتابعة الكثيرة التي لابد أن تتعارض في أجزائها مع بعض أجزائها الأخرى.</p>
</section>
<section id="برمجيات-التحكم-في-نسخ-النص-البرمجي-git-مثالا" class="slide level2">
<h2>برمجيات التحكم في نُسَخ النص البرمجي: <code>git</code> مثالاً</h2>
<p>اعتمد المبرمجون أدوات لمتابعة التغير في النص البرمجي نفسه عبر الزمن. تسمى هذه الأدات: <strong>نظام التحكم النسخ</strong> (Version Control System - VCS) ومن أشهر أمثلته برمجيَّة <code>git</code> التي طوَّرها المهندس الفنلندي (لينس تورفلادز - Linus Torvalds) أثناء اختراعه لنظام لينكس (Linux) ليسهِّل متابعة تطوُّر الكود.</p>
<p>إحدى خصائص قت المشهورة: إظهار الفرق (diff) بين نقطتي حفظ لنفس الملف:</p>

<img data-src="assets/006_git_diff.png" class="r-stretch"><p>صورة: على اليمين النص الجديد (الأخضر إضافات)، على اليسار النص القديم (الأحمر حذف).</p>
<p>ومن خصائص <code>git</code>:</p>
<ol type="1">
<li>متابعة تطوُّر ملفات المشروع بحسب نقاط الحفظ المعتمدة والمسندة لمؤلفيها سطرًا بسطر، بالوقت والتاريخ، وسبب التعديل.</li>
<li>إمكان الرجوع بالزمن لنقطة حفظ معيَّنة لسطر معيَّن؛ هذا يعني (Undo / <code>Ctrl+Z</code>) لأعلى مستوى ممكن</li>
<li>إضافة نقطة تحقق قبل اعتماد التغيير من المساهم إلى النسخة الأخيرة؛ تسمح بمراجعة كل تغيير من كل مساهِم طِبقًا لمعايير المشروع (الصحة، الجودة، الأمن، الكفاءة، …إلخ).</li>
</ol>
<p>إن استعمال <code>git</code> من المهارات التي إذا فقدها المبرمج؛ فإننا نتساءل في كوْنه مبرمجًا حقيقيًا أو يدعي ذلك فقط. قد تجد هذا الموقع مفيدًا في تعلم أهم ما في <code>git</code> في أقل وقت ممكن. الرابط: https://git30minutes.com/</p>
<p>أو هذا الكتاب المجاني في الوقع الرسمي لتحميل برمجية <code>git</code> نفسها: https://git-scm.com/learn</p>
</section>
<section id="ضرورة-متابعة-تطورات-المخطط" class="slide level2">
<h2>ضرورة متابعة تطورات المخطط</h2>
<p>أوامِر التعريف (DDL) من إنشاء وتعديل وحذف على <strong>مخطط البيانات</strong> (Data Schema) إذا تم تنفيذها على جهاز أحد المطورين، فإنه لا ضمان عندنا للتكرارية؛ أي: لتناظر المخطط عند كل المطورين للبرنامج. يحصل هذا حين تكون الأوامِر مُرسلَة غير مدوَّنة ولا مقيَّدة؛ فهي تُكتَب في سطر الأوامر وينفذها نظام قاعدة البيانات.</p>
<p>الإشكال الثاني هو أن هذه الأوامِر تعديلٌ يصعب الرجوع عنه. فنحن إذا طبقنا هذا التغيير في بيئة الإنتاج / التشغيل (عند المستخدم الحقيقي)، ثم تبيَّن لنا أنه أدى لخطأ، فكيف نعيد الحال السابقة للتغيير! سنتأخر كثيرًا إن لم يُضبَط الأمر وتتم أتمتته.</p>
<p>وحلُّ هذه المشكلة: أن يتم كتابة الأوامِر هذه نصًّا برمجيًّا وتُدرَجُ ضمن ما يُتابَع في نظام التجكم بالنسخ (<code>git</code>)، ويكون هو المرجِع فيما تمَّ إجراؤه أو لم يتمَّ من أوامِر التعريف على <strong>مخطط البيانات</strong>.</p>
<p>وفوق ذلك فإن كل عمليَّة إضافية يتم معها كتابة عكسها، حتى يتسنى لنا الرجوع عنها بسرعة.</p>
<p>وبهذا يكون لدينا تطوُّر المخطط عبر الزمن مدوَّنًا، وقابلًا للتنفيذ بشكل تلقائي في أي بيئة. ويُمكن أن نخطوَ بعض الخطو فيه ثم نرجع عددًا ما من الخطوات.</p>
<p>منح المبرمجون اسمًا لهذه الآلية، وهي نصوص التغيير (Change Scripts)؛ فهي تتابع تطورات المخطط تعديلاً تعديلاً. والمصطلح الشائع له في قواعد البيانات: نصوص الترحيل (Migration Scripts).</p>
</section>
<section id="إنشاء-نصوص-التغيير" class="slide level2">
<h2>إنشاء نصوص التغيير</h2>
<p>أداة <a href="https://github.com/amacneil/dbmate"><code>dbmate</code></a>؛ هي أداة لترحيل قواعد البيانات تحافظ على تزامن مخطط قاعدة بياناتك بين المطورين المتعددين وخوادم الإنتاج لديك.</p>
<h3 id="التثبيت">التثبيت</h3>
<p>راجع <a href="https://github.com/amacneil/dbmate?tab=readme-ov-file#installation">طريقة التثبيت في الصفحة</a>.</p>
<p>على نظام لينكس:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="fu">sudo</span> curl <span class="at">-fsSL</span> <span class="at">-o</span> /usr/local/bin/dbmate https://github.com/amacneil/dbmate/releases/latest/download/dbmate-linux-amd64</span>
<span id="cb1-2"><a></a><span class="fu">sudo</span> chmod +x /usr/local/bin/dbmate</span>
<span id="cb1-3"><a></a><span class="ex">/usr/local/bin/dbmate</span> <span class="at">--help</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h3 id="الأوامر">الأوامر</h3>
<pre><code>dbmate --help    # print usage help
dbmate new       # generate a new migration file
dbmate up        # create the database (if it does not already exist) and run any pending migrations
dbmate create    # create the database
dbmate drop      # drop the database
dbmate migrate   # run any pending migrations
dbmate rollback  # roll back the most recent migration
dbmate down      # alias for rollback
dbmate status    # show the status of all migrations (supports --exit-code and --quiet)
dbmate dump      # write the database schema.sql file
dbmate load      # load schema.sql file to the database
dbmate wait      # wait for the database server to become available</code></pre>
<p>يبحث البرنامج عن متغيِّر بيئة باسم <code>DATABASE_URL</code>، كما أنه يقرأ الملف الذي باسم <code>.env</code> إن وجده بالجوار. سننشئ هذا الرابط على النحو المتوقع، وهو:</p>
<pre><code>protocol://username:password@host:port/database_name?options</code></pre>
<p>نكتب في ملف <code>.env</code> الآتي:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource .env number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a></a>DATABASE_URL="postgres://user123:password123@127.0.0.1:5432/testdb?sslmode=disable"</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>لاحظ وجود <code>?sslmode=disable</code> وذلك أنَّنا نريد تعطيل هذه الخاصيَّة الأمنية لأننا لم نقم بتفعيلها أصلاً.</p>
<h3 id="إنشاء-نصوص-التغيير-1">إنشاء نصوص التغيير</h3>
<p>ننفذ الأمر:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">dbmate</span> new <span class="st">"add_users_table"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>سينشئ هذا ملفًّا فيه قسمان على هذا النحو:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a></a><span class="co">-- migrate:up</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a><span class="co">-- migrate:down</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>نضع تحت القسم الأوَّل التعديل الجديد، وعكسه تحت القسم الثاني. وهذا مثال:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a></a><span class="co">-- migrate:up</span></span>
<span id="cb7-2"><a></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (<span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>);</span>
<span id="cb7-3"><a></a></span>
<span id="cb7-4"><a></a><span class="co">-- migrate:down</span></span>
<span id="cb7-5"><a></a><span class="kw">DROP</span> <span class="kw">TABLE</span> users;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>لاحظ أن أمر إنشاء الجدول <code>CREATE TABLE</code> يعكسه أمر حذف الجدول <code>DROP TABLE</code>؛ وكلاهما يعمل على نفس الجدوَل.</p>
<p>ثم نحدِّث نماذجنا في بايثون لتعكس التغيير الجديد:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="im">from</span> sqlalchemy <span class="im">import</span> MetaData, Table, Column, Integer</span>
<span id="cb8-2"><a></a></span>
<span id="cb8-3"><a></a>metadata <span class="op">=</span> MetaData()</span>
<span id="cb8-4"><a></a></span>
<span id="cb8-5"><a></a>users <span class="op">=</span> Table(</span>
<span id="cb8-6"><a></a>    <span class="st">"users"</span>,</span>
<span id="cb8-7"><a></a>    metadata,</span>
<span id="cb8-8"><a></a>    Column(<span class="st">"id"</span>, Integer, primary_key<span class="op">=</span><span class="va">True</span>, autoincrement<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb8-9"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h3 id="إجراء-نصوص-التغيير">إجراء نصوص التغيير</h3>
<p>ننفذ الأمر:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a></a><span class="ex">dbmate</span> up</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>وإن أردنا العكس استعمال النقيض:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">dbmate</span> down</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>كما يمكنك معرفة حال الترحيل بالأمر:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="ex">dbmate</span> status</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h3 id="المرة-الثانية-تغييرات-جديدة">المرة الثانية: تغييرات جديدة</h3>
<p>ومثل ذلك سيكون في تغيير الأعمدة. تأمل هذا المثال:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a></a><span class="co">-- migrate:up</span></span>
<span id="cb12-2"><a></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> users <span class="kw">ADD</span> <span class="kw">COLUMN</span> email <span class="dt">VARCHAR</span>;</span>
<span id="cb12-3"><a></a></span>
<span id="cb12-4"><a></a><span class="co">-- migrate:down</span></span>
<span id="cb12-5"><a></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> users <span class="kw">DROP</span> <span class="kw">COLUMN</span> email;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>هناك خياران في إضافة التغييرات في كل مرة:</p>
<ol type="1">
<li>يمكنك تكرار هذه الأقسام لتكون التغييرات في ملف واحد</li>
<li>أو أن تنشئ ملفًا جديدًا لكل تغيير على حدة (<code>dbmate new</code>)</li>
</ol>
<p>ثم نعكس هذا التحديث الجديد في بايثون، ليصبح الجدول الآن بهذا الشكل:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>users <span class="op">=</span> Table(</span>
<span id="cb13-2"><a></a>    <span class="st">"users"</span>,</span>
<span id="cb13-3"><a></a>    metadata,</span>
<span id="cb13-4"><a></a>    Column(<span class="st">"id"</span>, Integer, primary_key<span class="op">=</span><span class="va">True</span>, autoincrement<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb13-5"><a></a>    Column(<span class="st">"email"</span>, String), <span class="co"># &lt;== NEW</span></span>
<span id="cb13-6"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>وحتى لا يفوتنا أن نعدل هذا ونترك ذك، نؤكد على جعل التغيير في الملفين (نص التغيير وبايثون) ضِمن تعديل واحد في سجل <code>git</code>. أي: يتم إضافتهما:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a></a><span class="fu">git</span> add db/migrations</span>
<span id="cb14-2"><a></a><span class="fu">git</span> add src/models.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>ثم اعتمادهما برسالة تلخِّص التغيير الذي حصل:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"schema: add email column to users table"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="خلاصة" class="slide level2">
<h2>خلاصة</h2>
<p>المشكلة ليست في تغيير مخطط قاعدة البيانات؛ المشكلة في تغييره سرًّا. أي تعديل غير مدوَّن في النص البرمجي فإنه نقطة ضعف في تطوُّر البرمجيَّة: مطوّر يضيف عمودًا، آخر لا يعلم بوجوده، والبيئة الإنتاجية تصبح في خطر.</p>
<p>الحلّ: التعامل مع مخطط البيانات كما نتعامل مع الكود—بنظام نسخ واضح، قابل للرجوع، وتحت رقابة git. هنا يأتي دوْر آلية ضبط تطوُّر المخطط: ملفات صغيرة تروي قصة كل تغيير بدقة الجرّاح، ومعها ترياق الرجوع عند الخطأ.</p>
<p>أداة dbmate تؤتمت العملية: توليد ملف ترحيل، كتابة التعديل في قسم migrate:up، وكتابة مضادّه في migrate:down. بعدها تُنفَّذ بـ dbmate up، وتُلغى بـ dbmate down .. آلية منظَّمة بدون خسارة بيانات.</p>
<p>أخيرًا: كل تغيير في المخطط يجب أن ينعكس على النموذج في بايثون، ويُعتمد الاثنان في نفس عملية git commit. وبهذا يصبح المخطط محفوظًا، متزامنًا، ويمكن الرجوع في الزمن.</p>
<p>بهذا نكون ختمنا المحور الأساسي الذي لا يستغني عنه أي تطبيق: قاعدة البيانات.</p>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../../assets/icon.svg" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"},{"title":"Index","icon":"<svg width='1.8rem' viewBox='0 0 24 24'><path d='M5 7h14M5 12h14M5 17h7' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>","src":"../index.html"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>