<!DOCTYPE html>
<html lang="en"><head>
<link href="../../assets/icon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="malfadly@sdaia.gov.sa">
  <title>AI Pros Bootcamp – Module 2 - Session 1: Data and Model Building</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-2476b6dbe24137c74cb80772f2f63bf0.css">
  <link rel="stylesheet" href="../../assets/sdaia.scss">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" href="../../assets/icon.svg">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../../assets/anim.svg" data-background-opacity="0.1" class="quarto-title-block center">
  <h1 class="title">Module 2 - Session 1: Data and Model Building</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="module-2-overview" class="slide level2">
<h2>Module 2 Overview</h2>
<p><strong>What will we learn?</strong></p>
<ul>
<li>Data Pipeline → handle large datasets</li>
<li>Beyond Sequential → custom architectures</li>
<li>Optimizers</li>
<li>Device Management</li>
<li>Building an image classifier</li>
</ul>
<aside class="notes">
<p>Welcome to Module 2! In this module, we’ll revisit the machine learning pipeline and see how PyTorch handles data at scale. We’ll dive deeper into loss functions and optimizers, learn about device management, and then bring it all together to build your first image classifier.</p>
<p>The question chain shows our progression: understanding data handling leads to understanding model architectures, which leads to understanding how models learn (loss and optimizers), which leads to practical implementation with device management, and finally building a complete image classifier.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="session-1-data-and-model-building" class="slide level2">
<h2>Session 1: Data and Model Building</h2>
<ul>
<li>Revisit the ML pipeline with a focus on PyTorch’s data handling tools</li>
<li>Learn about data management at scale</li>
<li>Explore building custom model architectures beyond the Sequential API</li>
</ul>
</section>
<section id="the-challenge-large-datasets" class="slide level2">
<h2>The Challenge: Large Datasets</h2>
<p><strong>100,000 delivery records</strong></p>
<p><strong>Problem:</strong> Loading all at once → runs out of memory</p>

<img data-src="../assets/delivery_company_data_challenge.png" class="quarto-figure quarto-figure-center r-stretch"><p><strong>Solution:</strong> Work with data in batches</p>
<aside class="notes">
<p>Let’s revisit the machine learning pipeline and see how PyTorch handles data. You already know about these steps from Module 1. But now, if you’re going to decode handwritten digits, you’re also going to need to understand PyTorch’s data handling tools.</p>
<p>Before we get into the complexities of image data, let’s start with something more familiar - that delivery data we looked at in Module 1. The same tools that can handle millions of delivery records can also handle millions of images. Once you see the pattern with simple data, images are going to make a lot more sense.</p>
<p>So let’s imagine your delivery company for Module 1 has grown. Instead of 10 deliveries, you now have 100,000 records to analyze. That’s a lot. Now imagine you wanted to try and load all 100,000 records at once. As you load this data, every piece needs to live in your computer’s RAM. With 100,000 records, you might be okay. But what if you had millions of records? Or if you added weather data, traffic patterns, driver info? At that scale, your computer can run out of memory and crash in no time.</p>
<p>That’s why you need to load your data piece by piece. The practical solution is to work with your data in batches - smaller, manageable chunks of the full dataset.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="pytorch-data-utilities" class="slide level2">
<h2>PyTorch Data Utilities</h2>
<p><strong>Three core tools:</strong></p>
<ol type="1">
<li><strong>Transforms</strong> - operations on each data point</li>
<li><strong>Dataset</strong> - fetches samples from disk on demand</li>
<li><strong>DataLoader</strong> - serves data in batches</li>
</ol>
<aside class="notes">
<p>But batching is just one part of the picture. Before your data is ready for training, you need to process it, format it, and serve it in a way that your model understands. That’s where three of PyTorch’s core data utilities come in: transforms, Dataset, and DataLoader. They each handle a key part of the process, and they’re designed to work well together.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="transforms" class="slide level2">
<h2>1. Transforms</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a>transform <span class="op">=</span> transforms.Compose([</span>
<span id="cb1-2"><a></a>    transforms.ToTensor(),</span>
<span id="cb1-3"><a></a>    transforms.Normalize(mean<span class="op">=</span><span class="fl">0.5</span>, std<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-4"><a></a>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>ToTensor:</strong> converts to tensors, scales 0-255 → 0-1</p>
<p><strong>Normalize:</strong> centers around 0, scales using standard deviation</p>
<aside class="notes">
<p>Let’s take a look at how transforms work. To apply transforms to data, you usually write something like this. Transforms are operations that run on each data point as it’s loaded, preparing your data for the model. Compose just means to do the following things in order.</p>
<p>Then you have the two most common transforms: ToTensor and Normalize. Neural networks are surprisingly picky. They train much better when all inputs are small numbers, ideally centered around 0. And that’s exactly what these two transforms do.</p>
<p>ToTensor converts your data into PyTorch tensors and scales them to fall between the values of 0 and 1. Normalize adjusts these values even further, centering them around 0 and then scaling using standard deviation. For now, just know that these will help your model train much more effectively, and you’ll learn more about them and other transform techniques in the next module.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="dataset" class="slide level2">
<h2>2. Dataset</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>dataset <span class="op">=</span> MNIST(root<span class="op">=</span><span class="st">'./data'</span>, train<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb2-2"><a></a>                download<span class="op">=</span><span class="va">True</span>, transform<span class="op">=</span>transform)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key features:</strong></p>
<ul>
<li>Fetches samples from disk when asked</li>
<li>Doesn’t preload everything</li>
<li>Handles where data lives, how to load samples, total count</li>
</ul>
<aside class="notes">
<p>Next up, you’re going to wrap your data in a Dataset object, which fetches each sample from disk when it’s asked to. It doesn’t preload everything in one shot, and that’s one of the secrets to handling massive datasets.</p>
<p>It handles things like where your data lives on disk, how to load a specific sample, how many total samples there are, and of course how to apply the transforms that you just saw to each sample as it’s being loaded.</p>
<p>This indicates where you store the data on your computer. <code>train=True</code> lets you choose between training and test sets of data. And if this is new for you, you’ll see a lot more about that when I discuss evaluation. And <code>download=True</code> downloads the data if it’s not already there.</p>
<p>You can retrieve a sample from your dataset simply by indexing it. In module 3, you’ll learn how to use the Dataset class to build custom datasets. But for now, we’ll stick to the pre-built ones that are available in PyTorch.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="dataloader" class="slide level2">
<h2>3. DataLoader</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>dataloader <span class="op">=</span> DataLoader(dataset, batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Batch size:</strong> how many samples per batch</p>
<p><strong>Shuffle:</strong> randomize order each epoch</p>
<p><strong>Makes training on large datasets possible</strong></p>
<aside class="notes">
<p>Once you’ve defined your dataset, you’re going to use a DataLoader to serve the data in batches. It’s part of the pipeline that makes training on large datasets possible, by requesting one batch at a time from your dataset.</p>
<p>Batch size tells the loader how many samples to serve at a time. You can also shuffle the data, which helps the model learn even more effectively during training.</p>
<p>Now let’s see the complete data pipeline in action. And you’re ready to train. This pattern efficiently handles datasets that would otherwise overwhelm your computer’s memory. And whether you’re working with thousands of delivery records or millions of images, the principle stays the same: load only what you need, when you need it.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="complete-data-pipeline" class="slide level2">
<h2>Complete Data Pipeline</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># 1. Define transforms</span></span>
<span id="cb4-2"><a></a>transform <span class="op">=</span> transforms.Compose([...])</span>
<span id="cb4-3"><a></a></span>
<span id="cb4-4"><a></a><span class="co"># 2. Create dataset</span></span>
<span id="cb4-5"><a></a>train_dataset <span class="op">=</span> MNIST(..., transform<span class="op">=</span>transform)</span>
<span id="cb4-6"><a></a></span>
<span id="cb4-7"><a></a><span class="co"># 3. Create dataloader</span></span>
<span id="cb4-8"><a></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span><span class="dv">64</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-9"><a></a></span>
<span id="cb4-10"><a></a><span class="co"># 4. Use in training loop</span></span>
<span id="cb4-11"><a></a><span class="cf">for</span> batch <span class="kw">in</span> train_loader:</span>
<span id="cb4-12"><a></a>    images, labels <span class="op">=</span> batch</span>
<span id="cb4-13"><a></a>    <span class="co"># train model</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<aside class="notes">
<p>But getting data into your model is just the beginning. In the rest of this session, you’ll tackle the rest of the ML pipeline, and then you’ll look at how loss functions and optimizers update your model.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="beyond-sequential-custom-models" class="slide level2">
<h2>Beyond Sequential: Custom Models</h2>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><strong><code>nn.Sequential</code></strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>model <span class="op">=</span> nn.Sequential(</span>
<span id="cb5-2"><a></a>    nn.Linear(<span class="dv">1</span>, <span class="dv">20</span>),</span>
<span id="cb5-3"><a></a>    nn.ReLU(),</span>
<span id="cb5-4"><a></a>    nn.Linear(<span class="dv">20</span>, <span class="dv">1</span>)</span>
<span id="cb5-5"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><strong><code>nn.Module</code></strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb6-2"><a></a><span class="kw">class</span> MyModel(nn.Module):</span>
<span id="cb6-3"><a></a>    <span class="co"># defines layers</span></span>
<span id="cb6-4"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb6-5"><a></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb6-6"><a></a>        <span class="va">self</span>.layer1 <span class="op">=</span> nn.Linear(<span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb6-7"><a></a>        <span class="va">self</span>.layer2 <span class="op">=</span> nn.Linear(<span class="dv">20</span>, <span class="dv">1</span>)</span>
<span id="cb6-8"><a></a>    </span>
<span id="cb6-9"><a></a>    <span class="co"># describes data flow</span></span>
<span id="cb6-10"><a></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb6-11"><a></a>        x <span class="op">=</span> <span class="va">self</span>.layer1(x)</span>
<span id="cb6-12"><a></a>        x <span class="op">=</span> F.relu(x)</span>
<span id="cb6-13"><a></a>        x <span class="op">=</span> <span class="va">self</span>.layer2(x)</span>
<span id="cb6-14"><a></a>        <span class="cf">return</span> x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p><strong>More control, same functionality</strong></p>
<aside class="notes">
<p>In the last video, you saw how PyTorch helps you manage your data. With tools like Dataset, Transforms, and DataLoader, you can load, prepare, and serve data efficiently, no matter the size of your dataset.</p>
<p>Now, let’s move on to the rest of the machine learning pipeline: model building, training, and evaluation. In Module 1, you saw Sequential in action. And of course, this works great, but there’s another pattern that you’ll see a lot in PyTorch: creating your model using <code>nn.Module</code>. This code does exactly the same thing as the Sequential version, just with more control.</p>
<p>So let’s take a closer look at the structure. Every PyTorch module class has two parts: <code>__init__</code> defines your layers, and <code>forward</code> describes how data flows through them.</p>
<p>In <code>__init__</code>, you’re just defining what layers exist. It’s a little bit like gathering your tools. The actual order comes in <code>forward</code>, and that’s where you describe the path that data is going to take through your model.</p>
<p>Now, this is similar to how Sequential orders the flow, but written in a different style. You’re going to see this pattern everywhere in PyTorch code.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="calling-the-model" class="slide level2">
<h2>Calling the Model</h2>
<p><strong>Don’t call <code>model.forward()</code> directly</strong></p>
<p><strong>Do call <code>model(input)</code></strong></p>
<p>PyTorch handles the forward call and essential bookkeeping</p>
<aside class="notes">
<p>But wait, you’ve defined this forward method. How do you actually run it? You might think <code>model.forward()</code>. But what if I told you that Sequential is a subclass of Module, and it too has a forward method? And how did you run that model? You never actually called forward directly. It’s the same for your custom model.</p>
<p>Well, when you call the model method and pass the data, PyTorch does more than just run your forward method. It also makes some internal checks, tracks the necessary math, and sets things up for updating the model later. And that’s why you always call <code>model(input)</code> and not <code>model.forward(input)</code>. PyTorch will handle that forward call for you, and it’s all wrapped up in the essential bookkeeping.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="why-super.__init__" class="slide level2">
<h2>Why <code>super().__init__()</code>?</h2>
<p><strong>Necessary for parameter tracking</strong></p>
<p>PyTorch needs to set up a system to track all learnable parameters (weights and biases)</p>
<p>Without it, PyTorch has nowhere to register your layers</p>
<aside class="notes">
<p>So what about this line, <code>super().__init__()</code>? Is it really necessary? You might think it’s just Python boilerplate, and maybe nothing bad happens if you skip it. But when you try to create your model, PyTorch needs to set up a system to track all of its learnable parameters. And these are the weights and biases that you’re going to update during training.</p>
<p>So when you call <code>super().__init__()</code>, it actually creates that tracking system for you. Without it, PyTorch has nowhere to register your layers. So always include it.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="training-loop-pattern" class="slide level2">
<h2>Training Loop Pattern</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="cf">for</span> batch <span class="kw">in</span> dataloader:</span>
<span id="cb7-2"><a></a>    optimizer.zero_grad()    <span class="co"># Clear old calculations</span></span>
<span id="cb7-3"><a></a>    outputs <span class="op">=</span> model(inputs)  <span class="co"># Forward pass</span></span>
<span id="cb7-4"><a></a>    loss <span class="op">=</span> loss_fn(outputs, targets)  <span class="co"># Measure error</span></span>
<span id="cb7-5"><a></a>    loss.backward()          <span class="co"># Calculate gradients</span></span>
<span id="cb7-6"><a></a>    optimizer.step()         <span class="co"># Update weights</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Order matters!</strong> Don’t swap these steps.</p>
<aside class="notes">
<p>Now let’s take a look at training. You’ve seen this training loop already in Module 1. This standard sequence is the core of most PyTorch training loops. <code>zero_grad()</code> clears out all the old calculations, <code>backward()</code> figures out the improvements, and <code>step()</code> updates your model.</p>
<p>But here’s the thing: if you don’t follow this standard order, your training might fail silently. PyTorch won’t throw an error, but your model won’t learn properly.</p>
<p>For example, what would happen if you swapped backward and step? Your code runs fine, but the model updates itself based on the previous batch’s calculations and not the current ones. Or if you put <code>zero_grad()</code> after backward, well, then you just threw away all of that work that backward did. What if you put <code>zero_grad()</code> outside the loop? Well, those calculations just pile up. Each batch will add to the previous one and your model starts making huge adjustments when it should just make tiny ones.</p>
<p>The next two videos will take a deeper dive into these topics. For now, just remember that this pattern is important. You almost always want the same order every time.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="evaluation" class="slide level2">
<h2>Evaluation</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a>model.<span class="bu">eval</span>()  <span class="co"># Set to evaluation mode</span></span>
<span id="cb8-2"><a></a><span class="cf">with</span> torch.no_grad():  <span class="co"># Disable gradient tracking</span></span>
<span id="cb8-3"><a></a>    <span class="cf">for</span> batch <span class="kw">in</span> test_loader:</span>
<span id="cb8-4"><a></a>        outputs <span class="op">=</span> model(inputs)</span>
<span id="cb8-5"><a></a>        <span class="co"># Calculate accuracy</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Two critical things:</strong></p>
<ul>
<li><code>model.eval()</code> - sets evaluation mode</li>
<li><code>torch.no_grad()</code> - disables gradient tracking</li>
</ul>
<aside class="notes">
<p>You’ve been training your model, but how do you know it’s actually learning? That’s what evaluation is for: testing your model on new data that it hasn’t previously seen and wasn’t trained on.</p>
<p>Two critical things here. <code>model.eval()</code>. Be careful - this is not a method that evaluates your model as some people mistakenly think. It just sets the model into evaluation mode. You need this because it’s both more efficient computationally and some layers in your model will behave in different ways during training and evaluation.</p>
<p><code>torch.no_grad()</code>. This will disable that extra tracking that PyTorch does during training. If you don’t turn it off, PyTorch will keep storing lots of details even when they’re not needed, and this wastes memory and might even crash your program during validation.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="measuring-performance" class="slide level2">
<h2>Measuring Performance</h2>
<p><strong>For classification:</strong> Accuracy</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>correct <span class="op">=</span> (predictions <span class="op">==</span> labels).<span class="bu">sum</span>().item()</span>
<span id="cb9-2"><a></a>total <span class="op">=</span> labels.size(<span class="dv">0</span>)</span>
<span id="cb9-3"><a></a>accuracy <span class="op">=</span> correct <span class="op">/</span> total</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Count correct predictions / total predictions</strong></p>
<aside class="notes">
<p>Now, the most important part of evaluation is to see how well your model has performed on new data that it hasn’t seen before. Testing on the training set would be like giving the student the same test twice. The student might just memorize the answers, but you want to see if they can apply what they’ve already learned.</p>
<p>Since you’re exploring image classification in this module, you can easily measure performance using accuracy. The accuracy calculation is straightforward: count how many times the model gets the classification right and divide that by the total attempts. If your model predicts 9,500 digits correctly out of 10,000, that’s 95% accuracy.</p>
<p>And don’t forget to switch back to training mode if you are returning the model to training.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="to-sum-up" class="slide level2">
<h2>To sum up</h2>
<ul>
<li>Data pipeline: Dataset, DataLoader, Transforms</li>
<li>Model building: <code>nn.Module</code></li>
<li>Training loop: <code>for batch in dataloader:</code></li>
<li>Evaluation: <code>model.eval()</code>, <code>torch.no_grad()</code>, <code>accuracy</code></li>
</ul>
<aside class="notes">
<ul>
<li><p><strong>Data pipeline:</strong> You start by organizing your data using a <code>Dataset</code> object, which defines how to access a single data point (like an image and its label). Then, you wrap your dataset in a <code>DataLoader</code>, which efficiently batches your data, shuffles it, and feeds it into your model during training and evaluation. Data transforms (using <code>transforms.Compose</code> and related utilities) are applied to preprocess, normalize, and augment your data. This pipeline ensures that data flows smoothly and efficiently to your model, handling everything from preprocessing to batching.</p></li>
<li><p><strong>Model building (<code>nn.Module</code>):</strong> You define your neural network architecture by subclassing <code>nn.Module</code>. Inside this class, you declare all the layers (like <code>nn.Linear</code>, <code>nn.Conv2d</code>, etc.) and implement the <code>forward</code> method, which describes how the input data passes through these layers to produce an output. This modular approach lets you build simple or highly complex models by stacking layers and adding activation functions, making PyTorch flexible for both quick prototypes and advanced research.</p></li>
<li><p><strong>Training loop (<code>for batch in dataloader:</code>):</strong> The heart of model training is the loop over batches of data. For each batch received from the <code>DataLoader</code>, you (1) run the input through the model to get predictions, (2) compute the loss by comparing predictions to the true labels, (3) perform backpropagation to compute gradients, and (4) update the model parameters using an optimizer. This iterative process gradually teaches your model to minimize the loss and improve accuracy, one batch at a time.</p></li>
<li><p><strong>Evaluation (<code>model.eval()</code>, <code>torch.no_grad()</code>, <code>accuracy</code>):</strong> When it’s time to review your model’s performance, you switch to evaluation mode using <code>model.eval()</code>, which adjusts the behavior of certain layers (like dropout and batchnorm). Wrapping your evaluation code with <code>torch.no_grad()</code> prevents PyTorch from tracking gradients, making evaluation faster and saving memory. Finally, you measure performance using metrics like accuracy—comparing model predictions to the true labels on unseen data to determine how well the model generalizes.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="whats-next" class="slide level2">
<h2>What’s Next?</h2>
<p>In <a href="../../W4_DL/C1_M2_PyTorch_Workflow/session2.html"><strong>Session 2: Loss Functions and Optimizers</strong></a>, you learn:</p>
<ul>
<li>How loss functions measure error</li>
<li>Cross-entropy loss for classification</li>
<li>How optimizers use gradients to update weights</li>
<li>Understanding backpropagation</li>
</ul>
<aside class="notes">
<p>You’ve now revisited the full pipeline: data loading, model building, training, and evaluation. But you’ve only scratched the surface of training. In the next session, we’re going to take a closer look at what’s happening with loss functions and optimizers - the mathematical foundations that make neural network learning possible.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../assets/icon.svg" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"},{"title":"Index","icon":"<svg width='1.8rem' viewBox='0 0 24 24'><path d='M5 7h14M5 12h14M5 17h7' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>","src":"../index.html"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>