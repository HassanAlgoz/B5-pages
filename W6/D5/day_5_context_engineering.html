<!DOCTYPE html>
<html lang="en"><head>
<link href="../../assets/icon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="malfadly@sdaia.gov.sa">
  <title>AI Pros Bootcamp – Day 5: Context Engineering</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-2476b6dbe24137c74cb80772f2f63bf0.css">
  <link rel="stylesheet" href="../../assets/sdaia.scss">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" href="../../assets/icon.svg">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../../assets/anim.svg" data-background-opacity="0.1" class="quarto-title-block center">
  <h1 class="title">Day 5: Context Engineering</h1>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="context-engineering" class="title-slide slide level1 center">
<h1>Context Engineering</h1>

</section>
<section id="the-context-window-constraint" class="slide level2 smaller scrollable">
<h2>The Context Window Constraint</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/context_window_funnel.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="A diagram of a funnel labeled ‘Context Window’ overflowing with documents, showing the ‘middle’ getting crushed."><img data-src="../assets/context_window_funnel.png" height="300" alt="A diagram of a funnel labeled ‘Context Window’ overflowing with documents, showing the ‘middle’ getting crushed."></a></p>
<figcaption>A diagram of a funnel labeled ‘Context Window’ overflowing with documents, showing the ‘middle’ getting crushed.</figcaption>
</figure>
</div>
<p><strong>Finite Application Memory</strong></p>
<ul>
<li><strong>Constraint</strong>: Models have a limit (8k, 128k, 1M tokens).</li>
<li><strong>Cost</strong>: More context = Higher Cost + Higher Latency.</li>
<li><strong>Challenge</strong>: “Lost in the Middle” phenomenon.</li>
</ul>
<aside class="notes">
<p><strong>Key points:</strong></p>
<ol type="1">
<li><strong>LLMs are stateless</strong> - Reasoning confined to single API call’s context window</li>
<li><strong>Cost &amp; latency scale</strong> - Even 1M token windows become expensive/unusable</li>
<li><strong>“Lost in the Middle”</strong> - Model attention degrades as context grows (context rot)</li>
<li><strong>Evolution from Prompt Engineering</strong> - From static instructions to dynamic, state-aware payload construction</li>
</ol>
<p><strong>Analogy:</strong> Context Engineering = mise en place (chef preparing ingredients). Goal: <strong>no more, no less</strong> than what’s needed right now.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="outline" class="slide level2 scrollable">
<h2>Outline</h2>
<ol type="1">
<li><strong>Context Engineering</strong>: Managing the input window.</li>
<li><strong>Sessions</strong>: Handling the “Now” (active conversation).</li>
<li><strong>Memory</strong>: Handling the “Past” (long-term storage).</li>
<li><strong>Production</strong>: Privacy, Lineage, and Ops.</li>
</ol>
<aside class="notes">
<p><strong>Session roadmap:</strong></p>
<ol type="1">
<li><p><strong>Context Engineering</strong> - Payload assembly: system instructions, tools, few-shot examples, memory, RAG, history. <strong>Dynamic</strong> = selective retrieval, task-relevant examples, query-based RAG.</p></li>
<li><p><strong>Sessions</strong> - “The Now”: dialogue history (events) + working memory (state). Events = user input, agent response, tool calls/outputs. State = structured scratchpad (e.g., shopping cart).</p></li>
<li><p><strong>Memory</strong> - “The Past”: long-term persistence across sessions. Lifecycle: Extract → Consolidate → Retrieve. Types: procedural (how-to), semantic (facts), episodic (history).</p></li>
<li><p><strong>Production</strong> - Privacy (PII, GDPR), security (data poisoning), evaluation (recall/precision/hallucination detection), ops (costs, latency, bloat).</p></li>
</ol>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="sessions" class="title-slide slide level1 center">
<h1>Sessions</h1>

</section>
<section id="what-is-a-session" class="slide level2 smaller scrollable">
<h2>What is a Session?</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/session_conversation.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Two people talking at a table labeled ‘Session’. A waiter (The System) holds a notepad with their recent quotes."><img data-src="../assets/session_conversation.png" height="300" alt="Two people talking at a table labeled ‘Session’. A waiter (The System) holds a notepad with their recent quotes."></a></p>
<figcaption>Two people talking at a table labeled ‘Session’. A waiter (The System) holds a notepad with their recent quotes.</figcaption>
</figure>
</div>
<p><strong>Short-Term Interaction State</strong></p>
<ul>
<li><strong>Scope</strong>: A single conversation thread or workflow.</li>
<li><strong>Storage</strong>: Ephemeral (In-memory or fast KV store like Redis).</li>
<li><strong>Goal</strong>: Coherency during a task.</li>
</ul>
<aside class="notes">
<p><strong>Session = “The Now”</strong> - Immediate dialogue history + working memory for single conversation.</p>
<p><strong>Two components:</strong></p>
<ol type="1">
<li><p><strong>Events</strong> (chronological history): user input, agent response, tool calls, tool outputs. Analogous to LLM API <code>Content</code> objects (role + parts).</p></li>
<li><p><strong>State</strong> (working memory): structured scratchpad for temporary data (e.g., shopping cart items, multi-step process current step).</p></li>
</ol>
<p><strong>Production note:</strong> Execution environments are stateless → must persist to DB (not just in-memory). Use robust databases (e.g., Redis for fast KV, SQL for structured). In dev, in-memory is fine.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="multi-agent-sessions" class="slide level2 smaller scrollable">
<h2>Multi-Agent Sessions</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/multi_agent_session.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="A round table with robots. In the center is a shared document. Each robot also has a private notebook."><img data-src="../assets/multi_agent_session.png" height="300" alt="A round table with robots. In the center is a shared document. Each robot also has a private notebook."></a></p>
<figcaption>A round table with robots. In the center is a shared document. Each robot also has a private notebook.</figcaption>
</figure>
</div>
<p><strong>Shared vs.&nbsp;Private State</strong></p>
<ul>
<li><strong>Shared State</strong>: All agents see the main thread (e.g., Slack channel).</li>
<li><strong>Private State</strong>: Agents have internal “scratchpads” or side-bars.</li>
<li><strong>Interoperability</strong>: Standardizing message formats across frameworks (LangChain, CrewAI).</li>
</ul>
<aside class="notes">
<p><strong>Multi-agent complexity:</strong> Multiple specialized agents must share information effectively.</p>
<p><strong>Key distinction:</strong> Session history (permanent transcript) vs.&nbsp;Context (crafted payload for single LLM turn).</p>
<p><strong>Two architectural patterns:</strong></p>
<ol type="1">
<li><p><strong>Shared unified history</strong> - All agents write to single log. Best for tightly coupled tasks (e.g., multi-step problem-solving where output → input). Sub-agents can filter/label before passing to LLM.</p></li>
<li><p><strong>Separate individual histories</strong> - Each agent has private log (black box). Communication via explicit messages (final output only, not process). Implemented via Agent-as-a-Tool or A2A Protocol.</p></li>
</ol>
<p><strong>Interoperability:</strong> Frameworks (ADK, LangGraph, LangChain, CrewAI) differ in session/event/state implementation. Frameworks = universal translator: stable internal API, varied external LLM APIs. Prevents vendor lock-in.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="memory" class="title-slide slide level1 center">
<h1>Memory</h1>

</section>
<section id="what-is-memory" class="slide level2 smaller">
<h2>What is Memory?</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/long_term_memory_archive.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="A library archive labeled ‘Memory’. A librarian robot is filing a book."><img data-src="../assets/long_term_memory_archive.png" height="300" alt="A library archive labeled ‘Memory’. A librarian robot is filing a book."></a></p>
<figcaption>A library archive labeled ‘Memory’. A librarian robot is filing a book.</figcaption>
</figure>
</div>
<p><strong>Long-Term Persistence</strong></p>
<ul>
<li><strong>Scope</strong>: Across sessions, days, or years.</li>
<li><strong>Storage</strong>: Durable (Vector DB, Graph DB, SQL).</li>
<li><strong>Goal</strong>: Personalization and Learning.</li>
</ul>
<aside class="notes">
<p><strong>Memory = “The Past”</strong> - Long-term persistence across sessions/days/years.</p>
<p><strong>Enables:</strong> “Welcome back, I remember you like Python” - personalization and learning.</p>
<p><strong>Storage:</strong> Durable systems (Vector DB, Graph DB, SQL) - not ephemeral. Must support similarity search, keyword matching, time-based triggers.</p>
<p><strong>Analogy:</strong> Memory = organized filing cabinet vs.&nbsp;Session = messy workbench. Don’t shove entire desk into storage - review, discard drafts, file only critical finalized docs. Keeps filing cabinet clean and reliable.</p>
<p><strong>Transforms:</strong> Stateless LLM → stateful intelligent agent with relationship continuity.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="types-of-memory" class="slide level2 smaller scrollable">
<h2>Types of Memory</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_types_brain.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="A diagram of a brain divided into three sections: ‘Skills’ (Procedural), ‘Facts’ (Semantic), ‘Story’ (Episodic)."><img data-src="../assets/memory_types_brain.png" height="300" alt="A diagram of a brain divided into three sections: ‘Skills’ (Procedural), ‘Facts’ (Semantic), ‘Story’ (Episodic)."></a></p>
<figcaption>A diagram of a brain divided into three sections: ‘Skills’ (Procedural), ‘Facts’ (Semantic), ‘Story’ (Episodic).</figcaption>
</figure>
</div>
<p><strong>Structure vs.&nbsp;Meaning</strong></p>
<ul>
<li><strong>Procedural</strong>: “How to do things” (Few-shot examples).</li>
<li><strong>Semantic</strong>: “Facts and Knowledge” (RAG).</li>
<li><strong>Episodic</strong>: “What happened” (User history).</li>
<li><strong>Multimodal</strong>: Images, Audio, Attachments.</li>
</ul>
<aside class="notes">
<p><strong>Memory types by purpose:</strong></p>
<ol type="1">
<li><p><strong>Procedural</strong> - “How to do things” (few-shot examples). Example: “Here is how you format a SQL query.” Guides reasoning via in-context learning. <strong>Powerful when task-relevant</strong> (not hardcoded generic).</p></li>
<li><p><strong>Semantic</strong> - “Facts and knowledge” (RAG). Example: “The capital of France is Paris.” Substantive data for reasoning. Sources: external KBs, documents, accumulated facts. Serves as ‘evidence’ for responses.</p></li>
<li><p><strong>Episodic</strong> - “What happened” (user history). Example: “Last week we debugged the login API.” Narrative of past interactions. Enables context, continuity, personalization, rapport.</p></li>
<li><p><strong>Multimodal</strong> - Images, audio, attachments. Artifacts stored/retrieved alongside text.</p></li>
</ol>
<p><strong>Organization patterns:</strong> Flat structures, hierarchical taxonomies, graph-based relationships.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="memory-lifecycle" class="slide level2 smaller scrollable">
<h2>Memory Lifecycle</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_lifecycle_loop.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="A cycle diagram: Extract -> Consolidate -> Store -> Retrieve -> Extract…"><img data-src="../assets/memory_lifecycle_loop.png" height="300" alt="A cycle diagram: Extract -> Consolidate -> Store -> Retrieve -> Extract…"></a></p>
<figcaption>A cycle diagram: Extract -&gt; Consolidate -&gt; Store -&gt; Retrieve -&gt; Extract…</figcaption>
</figure>
</div>
<p><strong>The Memory Loop</strong></p>
<ol type="1">
<li><strong>Extraction</strong>: Identifying useful info from a session.</li>
<li><strong>Consolidation</strong>: Merging new info with old (summarization).</li>
<li><strong>Retrieval</strong>: Fetching relevant info for the current context.</li>
</ol>
<aside class="notes">
<p><strong>Memory lifecycle:</strong> Transform raw conversation → useful persistent knowledge.</p>
<ol type="1">
<li><p><strong>Extract</strong> - Identify useful info from session. Example: “Oh, the user mentioned they use VsCode.” Not automatic - need mechanisms: pattern matching, LLM-based analysis, explicit triggers. <strong>Key:</strong> Distinguish signal from noise.</p></li>
<li><p><strong>Consolidate</strong> - Merge new with old. Example: Update profile, don’t append “Uses VsCode” 50 times. Prevents redundancy. Involves: summarization, deduplication, conflict resolution (Python last week → Java this week?), temporal relationships. <strong>Memory evolves, doesn’t just accumulate.</strong></p></li>
<li><p><strong>Retrieve</strong> - Fetch relevant info for current context. <strong>Critical:</strong> Can’t inject all memories (context bloat/cost). Must be selective: similarity search, keyword matching, time-based triggers. Timing: eager (before generation, like RAG) vs.&nbsp;lazy (during generation, agent decides).</p></li>
</ol>
<p><strong>Loop:</strong> Extract → Consolidate → Store → Retrieve → Extract (from new sessions). Keeps memory current and relevant.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="deep-dive-generation-strategy" class="slide level2 smaller scrollable">
<h2>Deep Dive: Generation Strategy</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_blocking_vs_background.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Parallel tracks: One showing ‘User Wait’ while memory saves, the other showing ‘User Reply’ while memory saves in background."><img data-src="../assets/memory_blocking_vs_background.png" height="300" alt="Parallel tracks: One showing ‘User Wait’ while memory saves, the other showing ‘User Reply’ while memory saves in background."></a></p>
<figcaption>Parallel tracks: One showing ‘User Wait’ while memory saves, the other showing ‘User Reply’ while memory saves in background.</figcaption>
</figure>
</div>
<p><strong>Blocking vs.&nbsp;Background</strong></p>
<ul>
<li><strong>Blocking</strong>: Wait for memory to update before replying (Consistent but Slow).</li>
<li><strong>Background</strong>: Reply immediately, update memory async (Fast but potentially inconsistent).</li>
<li><strong>Memory-as-a-Tool</strong>: Agent <em>decides</em> when to save a memory.</li>
</ul>
<aside class="notes">
<p><strong>Memory generation timing - critical design decision:</strong></p>
<ol type="1">
<li><p><strong>Blocking</strong> - Wait for DB write before replying. <strong>Pros:</strong> Consistent (memory guaranteed available next turn). <strong>Cons:</strong> Latency (especially LLM-based extraction, expensive DB writes). Unacceptable for user-facing apps.</p></li>
<li><p><strong>Background</strong> - Reply immediately, update async. <strong>Pros:</strong> Fast response. <strong>Cons:</strong> Race conditions (“What did I just say?” → “I don’t know yet”). Problematic for conversational agents expecting immediate recall.</p></li>
<li><p><strong>Memory-as-a-Tool</strong> - Agent has <code>save_memory()</code> / <code>remember_this()</code> tools. <strong>Hybrid:</strong> Critical info saved synchronously, less critical deferred. Agent decides: “Important now” vs.&nbsp;“Nice to have later”. <strong>Balances consistency + performance, gives agent agency.</strong></p></li>
</ol>
<p><strong>Triggering:</strong> End of turn (auto), specific events (user mentions preference), schedule (batch), explicit tools. Affects freshness and computational cost.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="memory-provenance" class="slide level2 smaller scrollable">
<h2>Memory Provenance</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_provenance.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="A detective board connecting a ‘Fact’ note to a ‘Source Document’ with a red string."><img data-src="../assets/memory_provenance.png" height="300" alt="A detective board connecting a ‘Fact’ note to a ‘Source Document’ with a red string."></a></p>
<figcaption>A detective board connecting a ‘Fact’ note to a ‘Source Document’ with a red string.</figcaption>
</figure>
</div>
<p><strong>Trusting the Source</strong></p>
<ul>
<li><strong>Lineage</strong>: “Where did this fact come from?” (User? Tool? hallucination?).</li>
<li><strong>Confidence</strong>: High (User explicitly stated) vs.&nbsp;Low (Inferred).</li>
<li><strong>Attribution</strong>: Citing the source message or document.</li>
</ul>
<aside class="notes">
<p><strong>Provenance = tracking origin, lineage, confidence</strong> - Essential for trust, debugging, data quality.</p>
<p><strong>Example:</strong> Agent believes “The sky is green” → Need to know: user said it? bad blog post? hallucination?</p>
<p><strong>Tracks:</strong> Source (user message, tool output, document), metadata (timestamps, session IDs, extraction method, confidence scores).</p>
<p><strong>Enables:</strong></p>
<ol type="1">
<li><strong>Debugging</strong> - Trace false memories to source</li>
<li><strong>Confidence scoring</strong> - User explicitly stated (high) vs.&nbsp;inferred (low)</li>
<li><strong>Attribution</strong> - Agent cites sources (“According to our previous conversation…”)</li>
<li><strong>Conflict resolution</strong> - When sources conflict, decide which to trust</li>
<li><strong>GDPR compliance</strong> - Know where memories are stored for deletion</li>
<li><strong>Data poisoning protection</strong> - Safeguards: “only trust verified sources”, “flag low confidence for review”</li>
</ol>
<p><strong>Principle:</strong> Never store a fact without source reference. Answer: Who? When? Context? Confidence?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="memory-retrieval" class="title-slide slide level1 center">
<h1>Memory Retrieval</h1>

</section>
<section id="timing-and-trigging" class="slide level2 smaller scrollable">
<h2>Timing and Trigging</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/retrieval_timing.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="A timeline. ‘Input’ -> ‘Eager Retrieval’ -> ‘Thinking’ -> ‘Lazy Retrieval’ -> ‘Output’."><img data-src="../assets/retrieval_timing.png" height="300" alt="A timeline. ‘Input’ -> ‘Eager Retrieval’ -> ‘Thinking’ -> ‘Lazy Retrieval’ -> ‘Output’."></a></p>
<figcaption>A timeline. ‘Input’ -&gt; ‘Eager Retrieval’ -&gt; ‘Thinking’ -&gt; ‘Lazy Retrieval’ -&gt; ‘Output’.</figcaption>
</figure>
</div>
<p><strong>When to remember?</strong></p>
<ul>
<li><strong>Eager</strong>: Retrieve <em>before</em> generating (RAG).</li>
<li><strong>Lazy</strong>: Retrieve <em>during</em> generation (Tool use).</li>
<li><strong>Trigger</strong>: Similarity search vs.&nbsp;Keyword match vs.&nbsp;Time-based.</li>
</ul>
<aside class="notes">
<p><strong>Retrieval timing - fundamental architectural decision:</strong></p>
<ol type="1">
<li><p><strong>Eager</strong> - Fetch before generation (like RAG). Flow: User asks Q → Look up docs → Answer. <strong>Pros:</strong> Complete context upfront. <strong>Cons:</strong> Must predict needs (might retrieve too much/little). <strong>Best for:</strong> Clear info needs (user profile, domain knowledge).</p></li>
<li><p><strong>Lazy</strong> - Fetch during generation when agent decides. Agent thinks: “I don’t know this, let me check my memory tool.” Tools: <code>search_memory()</code>, <code>recall_user_preference()</code>. <strong>Pros:</strong> Flexible, efficient (only what’s needed). <strong>Cons:</strong> Complex reasoning, multiple tool calls. <strong>Best for:</strong> Unpredictable needs, agent control desired.</p></li>
</ol>
<p><strong>Trigger mechanisms:</strong></p>
<ul>
<li><strong>Similarity search</strong> (embeddings) - Powerful but expensive</li>
<li><strong>Keyword matching</strong> - Fast, predictable, less flexible</li>
<li><strong>Time-based</strong> - Recent memories or specific periods</li>
<li><strong>Hybrid</strong> - Combine for sophisticated retrieval</li>
</ul>
<p><strong>Balance:</strong> Recall (find all relevant) vs.&nbsp;Precision (avoid irrelevant). Too much = context bloat/cost. Too little = missing context. Tune by use case, memory store size, performance requirements.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="inference-with-memories" class="slide level2 smaller scrollable">
<h2>Inference with Memories</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/inference_memory_injection.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="A prompt construction diagram showing ‘System Prompt’ + ‘Relevant Memories’ + ‘User Query’ merging into ‘Model Input’."><img data-src="../assets/inference_memory_injection.png" height="300" alt="A prompt construction diagram showing ‘System Prompt’ + ‘Relevant Memories’ + ‘User Query’ merging into ‘Model Input’."></a></p>
<figcaption>A prompt construction diagram showing ‘System Prompt’ + ‘Relevant Memories’ + ‘User Query’ merging into ‘Model Input’.</figcaption>
</figure>
</div>
<p><strong>Injecting State</strong></p>
<ul>
<li><strong>System Instructions</strong>: “You are helpful. (User info: Name=Dave, Lang=Python)”.</li>
<li><strong>Conversation History</strong>: Injecting relevant past summaries.</li>
<li><strong>Tools</strong>: Giving the agent a <code>search_memory()</code> tool.</li>
</ul>
<aside class="notes">
<p><strong>Memory injection strategies:</strong></p>
<ol type="1">
<li><p><strong>System Instructions</strong> - Embed stable, frequently-used info. Example: “You are helpful. User’s name is Dave, prefers Python, works on backend.” <strong>Pros:</strong> Always available, no retrieval. <strong>Cons:</strong> Only small amounts (bloat risk). <strong>Best for:</strong> Core user profile.</p></li>
<li><p><strong>Conversation History</strong> - Prepend past summaries, key facts. Example: “In our previous conversation, we discussed…” <strong>Pros:</strong> Maintains flow, provides context. <strong>Cons:</strong> Risk duplication/confusion. <strong>Best for:</strong> Episodic memories.</p></li>
<li><p><strong>Dynamic Tools</strong> - Agent calls <code>search_memory(query)</code>, <code>get_user_preference(key)</code>, <code>recall_past_conversation(topic)</code>. <strong>Pros:</strong> Flexible, on-demand. <strong>Cons:</strong> Requires sophisticated agent, multiple tool calls (latency). <strong>Best for:</strong> Less stable, voluminous memories.</p></li>
<li><p><strong>Procedural (Few-shot)</strong> - In system instructions or prompt examples. <strong>Key:</strong> Task-relevant examples (dynamic selection) &gt; static hardcoded.</p></li>
</ol>
<p><strong>Well-designed system:</strong> Combination - core profile in system, frequent facts in history, specialized via tools.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="production-considerations" class="title-slide slide level1 center">
<h1>Production Considerations</h1>

</section>
<section id="privacy-security" class="slide level2 smaller">
<h2>Privacy &amp; Security</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_privacy_vault.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="A vault door labeled ‘Private Memory’ with a ‘GDPR Compliant’ stamp."><img data-src="../assets/memory_privacy_vault.png" height="300" alt="A vault door labeled ‘Private Memory’ with a ‘GDPR Compliant’ stamp."></a></p>
<figcaption>A vault door labeled ‘Private Memory’ with a ‘GDPR Compliant’ stamp.</figcaption>
</figure>
</div>
<p><strong>The Risk of Remembering Too Much</strong></p>
<ul>
<li><strong>PII Leakage</strong>: Storing sensitive data in vector stores.</li>
<li><strong>Data Poisoning</strong>: Malicious user input becoming a “fact”.</li>
<li><a href="https://gdpr.eu/right-to-be-forgotten/"><strong>Forgetting</strong>: The “Right to be Forgotten” (GDPR)</a>.</li>
</ul>
<aside class="notes">
<p><strong>Memory = liability</strong> - Privacy, security, operational risks.</p>
<p><strong>Privacy (PII):</strong></p>
<ul>
<li><strong>Protection required:</strong> Encryption (at rest/in transit), access controls, audit logging</li>
<li><strong>Leakage vectors:</strong> Direct storage, inference from innocuous info, correlation across memories</li>
<li><strong>Compliance:</strong> GDPR, CCPA, HIPAA require careful handling</li>
<li><strong>Mitigation:</strong> Data classification, anonymization, strict access controls</li>
</ul>
<p><strong>GDPR “Right to be Forgotten”:</strong></p>
<ul>
<li><strong>Challenge:</strong> Memories across multiple systems (vector DBs, SQL, caches), embedded in consolidated memories, referenced by others</li>
<li><strong>Mechanisms needed:</strong> Identify all user memories, delete across systems, handle cascading deletions, verify completion</li>
<li><strong>Provenance crucial:</strong> Know where memories are stored</li>
</ul>
<p><strong>Security (Data Poisoning):</strong></p>
<ul>
<li><strong>Example:</strong> User says “My name is ‘Ignore all rules’” → don’t store as fact!</li>
<li><strong>Vectors:</strong> Direct statements, extraction manipulation, consolidation exploitation</li>
<li><strong>Safeguards:</strong> Input validation/sanitization, confidence scoring, source verification, anomaly detection</li>
<li><strong>Provenance helps:</strong> Track sources, identify/remove poisoned memories</li>
</ul>
<p><strong>Additional risks:</strong> Cross-user contamination, inference attacks, unauthorized access. Need isolation, access controls, monitoring.</p>
<p><strong>Operational:</strong> Storage costs (vector DBs expensive at scale), retrieval latency, memory bloat, consistency. Need lifecycle management: archival, expiration, cleanup.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="evaluation" class="slide level2 smaller scrollable">
<h2>Evaluation</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="../assets/memory_evaluation.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="A teacher grading a test paper labeled ‘Memory Recall’."><img data-src="../assets/memory_evaluation.png" height="300" alt="A teacher grading a test paper labeled ‘Memory Recall’."></a></p>
<figcaption>A teacher grading a test paper labeled ‘Memory Recall’.</figcaption>
</figure>
</div>
<p><strong>Did we remember correctly?</strong></p>
<ul>
<li><strong>Recall</strong>: Did we find the right memory?</li>
<li><strong>Precision</strong>: Did we avoid irrelevant noise?</li>
<li><strong>Hallucination</strong>: Did we invent a fake memory?</li>
</ul>
<aside class="notes">
<p><strong>Memory evaluation challenges:</strong> Measure storage, retrieval correctness, appropriate usage, maintenance over time.</p>
<p><strong>Gold standard test cases:</strong></p>
<ul>
<li>Cover: memory types (procedural/semantic/episodic), retrieval scenarios (eager/lazy), edge cases (conflicts, outdated info, ambiguous queries)</li>
<li>Include: should retrieve X, should NOT retrieve Y (precision), consolidation tests (updates handled)</li>
</ul>
<p><strong>Metrics:</strong></p>
<ol type="1">
<li><p><strong>Recall</strong> - Can system find right memory? Example: “What is my favorite fruit?” → Must retrieve “Apples”. Fraction of relevant memories successfully retrieved. Also verify correct usage in response.</p></li>
<li><p><strong>Precision</strong> - Avoid irrelevant noise. Example: Retrieves “Apples” (correct) but also “Oranges” (incorrect) = precision problem. High recall + low precision = context bloat. High precision + low recall = missing relevant. <strong>Ideal:</strong> High recall + high precision.</p></li>
<li><p><strong>Hallucination detection</strong> - Agent invents fake memory or incorrectly consolidates. Test: Agent doesn’t “remember” things never stored, handles “no relevant memory” correctly (“I don’t know” not made-up).</p></li>
</ol>
<p><strong>Lifecycle testing:</strong> Extraction, consolidation, retrieval, deletion. End-to-end tests simulating real interactions.</p>
<p><strong>Scenarios:</strong> New users, returning users, memory updates, conflicts, edge cases (empty/ambiguous/malicious queries). Automated + manual evaluation.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="summary" class="title-slide slide level1 center">
<h1>Summary</h1>

</section>
<section id="key-takeaways" class="slide level2">
<h2>Key Takeaways</h2>
<ul>
<li><strong>Context is Finite</strong>: Engineer it carefully.</li>
<li><strong>Sessions are Now</strong>: Manage short-term state for coherency.</li>
<li><strong>Memory is Past</strong>: Extract, Consolidate, and Retrieve for long-term value.</li>
<li><strong>Provenance is Key</strong>: Know where your facts came from.</li>
</ul>
<aside class="notes">
<p><strong>Summary - Context Engineering foundation:</strong></p>
<p><strong>Models are stateless → You are the state manager.</strong> Construct context for every turn: strategically select, summarize, inject. Evolution from Prompt Engineering (static) to Context Engineering (dynamic, state-aware).</p>
<p><strong>Sessions = “The Now”</strong> - Turn-by-turn state: events (dialogue history) + state (working memory). Ephemeral workbench. Multi-agent: shared (unified) or separate (individual) histories.</p>
<p><strong>Memory = “The Past”</strong> - Long-term persistence across sessions. Filing cabinet (not messy desk). Lifecycle: Extract → Consolidate → Retrieve. Types: procedural, semantic, episodic, multimodal.</p>
<p><strong>Provenance is key</strong> - Track origin, confidence, source. Enables debugging, trust, data poisoning protection. Never store fact without source reference.</p>
<p><strong>Production:</strong> Privacy (PII, GDPR), security (data poisoning), evaluation (recall/precision/hallucination), ops (costs, latency, bloat). Context cycle: Fetch → Prepare → Invoke → Upload.</p>
<p><strong>Context Engineering = mise en place</strong> - No more, no less than what’s needed. Transforms stateless LLMs → stateful intelligent agents.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../assets/icon.svg" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"},{"title":"Index","icon":"<svg width='1.8rem' viewBox='0 0 24 24'><path d='M5 7h14M5 12h14M5 17h7' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>","src":"../index.html"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>